{"version":3,"file":"canvas-select.min.js","sources":["../src/tools.ts","../src/shape/Shape.ts","../src/index.ts","../src/shape/Rect.ts","../src/shape/Polygon.ts","../src/shape/Dot.ts","../src/EventBus.ts","../src/shape/Line.ts","../src/shape/Circle.ts","../src/shape/Grid.ts","../src/shape/Brush.ts","../src/shape/Mask.ts","../src/shape/Pencil.ts"],"sourcesContent":["import Shape from \"./shape/Shape\";\r\n\r\nexport function createUuid(): string {\r\n  const s: any[] = [];\r\n  const hexDigits = \"0123456789abcdef\";\r\n  for (let i = 0; i < 36; i++) {\r\n    const m = Math.floor(Math.random() * 0x10);\r\n    s[i] = hexDigits.slice(m, m + 1);\r\n  }\r\n  s[14] = \"4\";\r\n  const n = (s[19] & 0x3) | 0x8;\r\n  s[19] = hexDigits.slice(n, n + 1);\r\n  s[8] = s[13] = s[18] = s[23] = \"-\";\r\n  const uuid = s.join(\"\");\r\n  return uuid;\r\n}\r\n\r\n/**\r\n * 判断图形是否符合嵌套关系, 业务需求：只需要判断shape2所有的点是否都在shape1内部即可\r\n * @param shape1 参数1\r\n * @param shape2 参数2\r\n * @reutrn Boolean 符合条件返回true 否则返回false\r\n */\r\n\r\nexport function isNested(shape1: any, shape2: any): boolean {\r\n  if (shape1.type === 1 && shape2.type === 1) {\r\n    // 矩形和矩形的判断逻辑\r\n    const [[x1, y1], [x2, y2]] = shape1.coor;\r\n    const [[x3, y3], [x4, y4]] = shape2.coor;\r\n\r\n    // if (x1 >= x3 && y1 >= y3 && x2 <= x4 && y2 <= y4) {\r\n    //   return true; // shape1 嵌套在 shape2 内部\r\n    // } else\r\n    if (x1 <= x3 && y1 <= y3 && x2 >= x4 && y2 >= y4) {\r\n      return true; // shape2 嵌套在 shape1 内部\r\n    } else {\r\n      return false; // 两个矩形没有嵌套关系\r\n    }\r\n  } else if (shape1.type === 1 && shape2.type === 2) {\r\n    // 矩形和多边形的判断逻辑，确保多边形所有的坐标点都在矩形里面\r\n    const [[x1, y1], [x2, y2]] = shape1.coor;\r\n    const vertices = shape2.coor;\r\n\r\n    for (let i = 0; i < vertices.length; i++) {\r\n      const [x, y] = vertices[i];\r\n      if (x < x1 || x > x2 || y < y1 || y > y2) {\r\n        return false; // 多边形的顶点在矩形外部，不嵌套\r\n      }\r\n    }\r\n\r\n    return true; // 所有顶点都在矩形内部，嵌套关系成立\r\n  } else if (shape1.type === 2 && shape2.type === 1) {\r\n    // 多边形和矩形的判断逻辑，确保矩形的所有坐标点都在多边形里面\r\n    const vertices = shape2.coor; // 矩形的顶点坐标\r\n\r\n    for (let i = 0; i < vertices.length; i++) {\r\n      const [x, y] = vertices[i];\r\n      if (!isPointInPolygon(x, y, shape1.coor)) {\r\n        return false; // 有一个坐标点不在多边形范围内，返回false\r\n      }\r\n    }\r\n\r\n    return true; // 所有坐标点都在多边形内部，返回true\r\n  } else if (shape1.type === 2 && shape2.type === 2) {\r\n    // 多边形和多边形的判断逻辑\r\n    const vertices1 = shape1.coor;\r\n    const vertices2 = shape2.coor;\r\n\r\n    for (let i = 0; i < vertices2.length; i++) {\r\n      const [x, y] = vertices2[i];\r\n      if (!isPointInPolygon(x, y, vertices1)) {\r\n        return false; // 多边形2的顶点不都在多边形1内部，不嵌套\r\n      }\r\n    }\r\n\r\n    return true; // 有坐标点都在多边形内部，返回true\r\n  }\r\n}\r\n\r\nfunction isPointInPolygon(x: number, y: number, vertices: any) {\r\n  let inside = false;\r\n  const n = vertices.length;\r\n\r\n  for (let i = 0, j = n - 1; i < n; j = i++) {\r\n    const xi = vertices[i][0];\r\n    const yi = vertices[i][1];\r\n    const xj = vertices[j][0];\r\n    const yj = vertices[j][1];\r\n\r\n    if (yi > y !== yj > y && x < ((xj - xi) * (y - yi)) / (yj - yi) + xi) {\r\n      inside = !inside;\r\n    }\r\n  }\r\n\r\n  return inside;\r\n}\r\n\r\n\r\n\r\n/**\r\n * 深拷贝函数\r\n */\r\nexport function deepClone<T>(obj: T, hash = new WeakMap()): T {\r\n  // 处理原始类型和 null、undefined\r\n  if (obj === null || typeof obj !== 'object') {\r\n    return obj;\r\n  }\r\n\r\n  // 处理循环引用\r\n  if (hash.has(obj)) {\r\n    return hash.get(obj);\r\n  }\r\n\r\n  // 处理 ImageData 对象\r\n  if (obj instanceof ImageData) {\r\n    // 创建一个新的 ImageData 对象，并拷贝其 data 属性\r\n    const newImageData = new ImageData(new Uint8ClampedArray(obj.data), obj.width, obj.height);\r\n    hash.set(obj, newImageData);\r\n    return newImageData as any;\r\n  }\r\n\r\n  // 处理 Date 对象\r\n  if (obj instanceof Date) {\r\n    return new Date(obj.getTime()) as any;\r\n  }\r\n\r\n  // 处理 RegExp 对象\r\n  if (obj instanceof RegExp) {\r\n    return new RegExp(obj.source, obj.flags) as any;\r\n  }\r\n\r\n  // 处理 Map 对象\r\n  if (obj instanceof Map) {\r\n    const result = new Map();\r\n    hash.set(obj, result);\r\n    obj.forEach((value, key) => {\r\n      result.set(deepClone(key, hash), deepClone(value, hash));\r\n    });\r\n    return result as any;\r\n  }\r\n\r\n  // 处理 Set 对象\r\n  if (obj instanceof Set) {\r\n    const result = new Set();\r\n    hash.set(obj, result);\r\n    obj.forEach(value => {\r\n      result.add(deepClone(value, hash));\r\n    });\r\n    return result as any;\r\n  }\r\n\r\n  // 处理数组\r\n  if (Array.isArray(obj)) {\r\n    const result: any[] = [];\r\n    hash.set(obj, result);\r\n    obj.forEach((item, index) => {\r\n      result[index] = deepClone(item, hash);\r\n    });\r\n    return result as T;\r\n  }\r\n\r\n  // 处理对象\r\n  const result = Object.create(Object.getPrototypeOf(obj));\r\n  hash.set(obj, result);\r\n\r\n  Reflect.ownKeys(obj).forEach(key => {\r\n    const value = (obj as any)[key];\r\n    result[key as keyof typeof result] = deepClone(value, hash);\r\n  });\r\n\r\n  return result as T;\r\n}\r\n\r\n\r\n\r\n\r\n/**\r\n * 判断两个对象的某些keys是否相等\r\n */\r\nexport function deepEqual(obj1: any, obj2: any, keysToCompare?: string[]): boolean {\r\n  // 如果两个对象或数组引用相同，直接返回 true\r\n  if (obj1 === obj2) return true;\r\n\r\n  // 如果 obj1 和 obj2 的 type 都为 8(Mask)，比较特定属性值\r\n  if (obj1.type === 8 && obj2.type === 8) {\r\n    const maskKeysToCompare = ['uuid', 'label', 'maskBase64'];\r\n    for (let key of maskKeysToCompare) {\r\n      if (obj1[key] !== obj2[key]) {\r\n        return false;\r\n      }\r\n    }\r\n    return true; // 如果 uuid, label, maskBase64 都相等，返回 true\r\n  }\r\n\r\n  // 检查是否为对象或数组\r\n  if (typeof obj1 !== 'object' || obj1 === null ||\r\n    typeof obj2 !== 'object' || obj2 === null) {\r\n    return false;\r\n  }\r\n\r\n  // 如果是数组，比较数组长度并递归比较每个元素\r\n  if (Array.isArray(obj1) && Array.isArray(obj2)) {\r\n    if (obj1.length !== obj2.length) return false;\r\n    for (let i = 0; i < obj1.length; i++) {\r\n      if (!deepEqual(obj1[i], obj2[i], keysToCompare)) {\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n\r\n  // 如果不是数组，则按对象处理\r\n  const keys1 = keysToCompare || Object.keys(obj1);\r\n\r\n  // 比较对象中的键值对\r\n  for (let key of keys1) {\r\n    if ((!(key in obj1) && (key in obj2) || ((key in obj1) && !(key in obj2))) || !deepEqual(obj1[key], obj2[key])) {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\n\r\n","import { createUuid } from \"../tools\";\r\n\r\ninterface ShapeProp {\r\n  type: number;\r\n  [key: string]: any;\r\n}\r\nexport default class Shape {\r\n  /** 标签id */\r\n  public tagId: string = \"\";\r\n  /** 标签名称 */\r\n  public label: string = \"\";\r\n  /** 标注Id(数据库中获得) */\r\n  public labelId: string = \"\";\r\n  /** 是否隐藏标签 */\r\n  public hideLabel: boolean;\r\n  /** 是否隐藏标签 */\r\n  public truncated: number = 0;\r\n  /** 坐标 */\r\n  public coor: any[] = [];\r\n  /** 边线颜色 */\r\n  public strokeStyle: string;\r\n  /** 填充颜色 */\r\n  public fillStyle: string;\r\n  /** 边线宽度 */\r\n  public lineWidth: number;\r\n  /** 标签填充颜色 */\r\n  public labelFillStyle: string;\r\n  /** 标签文字颜色 */\r\n  public textFillStyle: string;\r\n  /** 标签文字字体 */\r\n  public labelFont: string;\r\n  /** 标签文字字型 */\r\n  public labelFontFamily: string;\r\n  /** 标签文字字号 */\r\n  public labelFontSize: number;\r\n  /** 1 矩形，2 多边形，3 点，4 折线，5 圆，6 网格 */\r\n  public type: number; // 形状\r\n  /** 当前是否处于活动状态 */\r\n  public active: boolean = false;\r\n  /** 当前是否处于创建状态 */\r\n  public creating: boolean = false;\r\n  /** 当前是否处于拖拽状态 */\r\n  public dragging: boolean = false;\r\n  /** 当前是否处于隐藏状态 */\r\n  public hiddening: boolean = false;\r\n  /** 当前是否处于锁定状态 */\r\n  public locking: boolean = false;\r\n  /** 备注 */\r\n  public remark: string;\r\n  /** 索引 */\r\n  public index: number;\r\n  /** 唯一标识 */\r\n  public uuid: string = createUuid();\r\n  /** 向上展示label */\r\n  public labelUp: boolean;\r\n  constructor(item: ShapeProp, index: number) {\r\n    this.index = index;\r\n    Object.assign(this, item);\r\n  }\r\n}\r\n","import Rect from \"./shape/Rect\";\r\nimport Polygon from \"./shape/Polygon\";\r\nimport Dot from \"./shape/Dot\";\r\nimport EventBus from \"./EventBus\";\r\nimport Line from \"./shape/Line\";\r\nimport Circle from \"./shape/Circle\";\r\nimport Grid from \"./shape/Grid\";\r\nimport Brush from \"./shape/Brush\";\r\nimport Mask from \"./shape/Mask\";\r\nimport Pencil from \"./shape/Pencil\";\r\nimport pkg from \"../package.json\";\r\nimport { isNested, createUuid, deepClone, deepEqual } from \"./tools\";\r\n\r\nexport type Point = [number, number];\r\nexport type AllShape =\r\n  | Rect\r\n  | Polygon\r\n  | Dot\r\n  | Line\r\n  | Circle\r\n  | Grid\r\n  | Brush\r\n  | Mask\r\n  | Pencil;\r\nenum Shape {\r\n  None,\r\n  Rect,\r\n  Polygon,\r\n  Dot,\r\n  Line,\r\n  Circle,\r\n  Grid,\r\n  Brush,\r\n  Mask,\r\n  Pencil\r\n}\r\n\r\ninterface MagicPoint {\r\n  coor: [number, number];\r\n  color: string;\r\n}\r\nexport default class CanvasSelect extends EventBus {\r\n  /** 当前版本 */\r\n  version = pkg.version;\r\n  /** 只读模式，画布不允许任何交互 */\r\n  lock: boolean = false;\r\n  /** 只读模式，仅支持查看 */\r\n  readonly: boolean = false;\r\n  /** 最小矩形宽度 */\r\n  MIN_WIDTH = 10;\r\n  /** 最小矩形高度 */\r\n  MIN_HEIGHT = 10;\r\n  /** 最小圆形半径 */\r\n  MIN_RADIUS = 5;\r\n  /** 最小轨迹点数 */\r\n  MIN_POINTNUM = 3;\r\n  /** 缩放图像的最小边长 */\r\n  MIN_LENGTH = 140;\r\n  /** 边线颜色 */\r\n  strokeStyle = \"#000\";\r\n  /** 填充颜色 */\r\n  fillStyle = \"rgba(0, 0, 255, 0.1)\";\r\n  /** 边线宽度 */\r\n  lineWidth = 2;\r\n  /** 当前选中的标注边线颜色 */\r\n  activeStrokeStyle = \"#000\";\r\n  /** 当前选中的标注填充颜色 */\r\n  activeFillStyle = \"#000\";\r\n  /** 控制点边线颜色 */\r\n  ctrlStrokeStyle = \"#000\";\r\n  /** 控制点填充颜色 */\r\n  ctrlFillStyle = \"#fff\";\r\n  /** 控制点半径 */\r\n  ctrlRadius = 3;\r\n  /** 是否隐藏标签 */\r\n  hideLabel = false;\r\n  /** 标签背景填充颜色 */\r\n  labelFillStyle = \"rgba(255, 255, 255, 0.5)\";\r\n  /** 标签字体 */\r\n  // labelFont = '12px sans-serif';\r\n  /** 标签字型 */\r\n  labelFontFamily = \"sans-serif\";\r\n  /** 标签字号 */\r\n  labelFontSize = 18;\r\n  /** 标签文字颜色 */\r\n  textFillStyle = \"#FFFFFF\";\r\n  /** 标签字符最大长度，超出使用省略号 */\r\n  labelMaxLen = 10;\r\n  /** 画布宽度 */\r\n  WIDTH = 0;\r\n  /** 画布高度 */\r\n  HEIGHT = 0;\r\n  /** 背景图src */\r\n  imagesrc = \"\";\r\n  imagealpha = 1;\r\n\r\n  canvas: HTMLCanvasElement;\r\n\r\n  ctx: CanvasRenderingContext2D;\r\n  /** 变化前的所有标注数据 */\r\n  olddataset: AllShape[] = [];\r\n  /** 所有标注数据 */\r\n  dataset: AllShape[] = [];\r\n\r\n  /** 撤销数组最多保存记录条数 */\r\n  MAX_LENGTH = 10;\r\n\r\n  // 保存一次完成的修改后的记录(触发按钮事件或鼠标抬起)\r\n  doneList: AllShape[][] = [];\r\n\r\n  // 保存撤销的记录\r\n  undoList: AllShape[][] = [];\r\n\r\n  /** 记录所有隐藏图形的uuid*/\r\n  hideList: string[] = [];\r\n\r\n  offScreen: HTMLCanvasElement;\r\n\r\n  offScreenCtx: CanvasRenderingContext2D;\r\n  /** 记录锚点距离 */\r\n  remmber: number[][];\r\n  /** 记录鼠标位置 */\r\n  mouse: Point;\r\n  /** 记录背景图鼠标位移 */\r\n  remmberOrigin: number[] = [0, 0];\r\n  /** 0 不创建，1 矩形，2 多边形，3 点，4 折线，5 圆，6 网格, 7 刷子brush, 8 Mask，9 钢笔 */\r\n  createType: Shape = Shape.None; //\r\n  /** 控制点索引 */\r\n  ctrlIndex = -1;\r\n  /** 选中控制点索引 */\r\n  clickIndex = -1;\r\n  /** 背景图片 */\r\n  image: HTMLImageElement = new Image();\r\n  /** 图片原始宽度 */\r\n  IMAGE_ORIGIN_WIDTH: number;\r\n  /** 图片缩放宽度 */\r\n  IMAGE_WIDTH = 0;\r\n  /** 图片原始高度 */\r\n  IMAGE_ORIGIN_HEIGHT = 0;\r\n  /** 图片缩放高度 */\r\n  IMAGE_HEIGHT = 0;\r\n  /** 原点x */\r\n  originX = 0;\r\n  /** 原点y */\r\n  originY = 0;\r\n  /** 图片缩放步长 */\r\n  scaleStep = 0;\r\n  /** 标签名缩放步长 */\r\n  textscaleStep = 0;\r\n  /** 滚动缩放 */\r\n  scrollZoom = true;\r\n\r\n  private timer: any;\r\n  /** 最小touch双击时间 */\r\n  dblTouch = 300;\r\n  /** 记录touch双击开始时间 */\r\n  dblTouchStore = 0; //\r\n  /** 这个选项可以帮助浏览器进行内部优化 */\r\n  alpha = true;\r\n  /** 专注模式 */\r\n  focusMode = false;\r\n  /** 记录当前事件 */\r\n  private evt: MouseEvent | TouchEvent | KeyboardEvent;\r\n  /** 触控缩放时记录上一次两点距离 */\r\n  scaleTouchStore = 0;\r\n  /** 当前是否为双指触控 */\r\n  isTouch2 = false;\r\n  isMobile = navigator.userAgent.includes(\"Mobile\");\r\n  /** 向上展示label */\r\n  labelUp = false;\r\n  private isCtrlKey = false;\r\n  /** 自定义ctrl快捷键 KeyboardEvent.code */\r\n  ctrlCode = \"ControlLeft\";\r\n  /** 网格右键菜单 */\r\n  gridMenuEnable = true;\r\n  /** 网格选中背景填充颜色 */\r\n  gridSelectedFillStyle = \"rgba(255, 255, 0, 0.8)\";\r\n\r\n  /** 记录是否正在使用brush */\r\n  ispainting = false;\r\n\r\n  /** brush线条样式 */\r\n  brushlineWidth = 1;\r\n  brushstrokeStyle = \"rgba(255, 0, 0, 0.8)\";\r\n\r\n  pencillineWidth = 0.5;\r\n  pencilstrokeStyle = \"rgba(255, 0, 0, 0.8)\";\r\n\r\n  // maskfillStyle = \"rgba(255, 0, 0, 0.5)\";\r\n  mask_alpha = 96;\r\n  densityFactor = 1;\r\n\r\n  /** 记录正在生成轮廓的mask的canvasData */\r\n  activeCanvasData: ImageData | null = null;\r\n  /** 记录正在生成的轮廓 */\r\n  activePolygon: string = \"\";\r\n\r\n  isEraser = false;\r\n  isErasing = false;\r\n\r\n  eraserPoints: [number, number][] = [];\r\n\r\n  eraserSize = 8; // 橡皮擦的半径\r\n\r\n  random_color = [\r\n    { r: 255, g: 0, b: 0 },\r\n    { r: 0, g: 255, b: 0 },\r\n    { r: 0, b: 255, g: 0 }\r\n  ];\r\n\r\n  isMagicToolActive = false;\r\n\r\n  magicPoints: MagicPoint[] = [];\r\n\r\n  maxLinePointCount = 2;\r\n\r\n  /**\r\n   * @param el Valid CSS selector string, or DOM\r\n   * @param src image src\r\n   */\r\n  constructor(el: HTMLCanvasElement | string, src?: string) {\r\n    super();\r\n    this.handleLoad = this.handleLoad.bind(this);\r\n    this.handleContextmenu = this.handleContextmenu.bind(this);\r\n    this.handleMousewheel = this.handleMousewheel.bind(this);\r\n    this.handleMouseDown = this.handleMouseDown.bind(this);\r\n    this.handleMouseMove = this.handleMouseMove.bind(this);\r\n    this.handleMouseUp = this.handleMouseUp.bind(this);\r\n    this.handleDblclick = this.handleDblclick.bind(this);\r\n    this.handleKeyup = this.handleKeyup.bind(this);\r\n    this.handleKeydown = this.handleKeydown.bind(this);\r\n    const container = typeof el === \"string\" ? document.querySelector(el) : el;\r\n    if (container instanceof HTMLCanvasElement) {\r\n      this.canvas = container;\r\n      this.offScreen = document.createElement(\"canvas\");\r\n      this.imagesrc = src;\r\n      this.initSetting();\r\n      this.initEvents();\r\n      src && this.setImage(src);\r\n      for (let i = 1; i <= 255; i++) {\r\n        const red = Math.floor(Math.random() * 256);\r\n        const green = Math.floor(Math.random() * 256);\r\n        const blue = Math.floor(Math.random() * 256);\r\n        this.random_color[i] = { r: red, g: green, b: blue };\r\n      }\r\n    } else {\r\n      console.warn(\"HTMLCanvasElement is required!\");\r\n    }\r\n  }\r\n\r\n  /** 当前选中的标注 */\r\n  get activeShape() {\r\n    return this.dataset.find((x) => x.active) || ({} as any);\r\n  }\r\n\r\n  /** 当前缩放比例 */\r\n  get scale() {\r\n    if (this.IMAGE_ORIGIN_WIDTH && this.IMAGE_WIDTH) {\r\n      return this.IMAGE_WIDTH / this.IMAGE_ORIGIN_WIDTH;\r\n    }\r\n    return 1;\r\n  }\r\n\r\n  /** 图片最小边尺寸 */\r\n  get imageMin() {\r\n    return Math.min(this.IMAGE_WIDTH, this.IMAGE_HEIGHT);\r\n  }\r\n\r\n  /** 图片原始最大边尺寸 */\r\n  get imageOriginMax() {\r\n    return Math.max(this.IMAGE_ORIGIN_WIDTH, this.IMAGE_ORIGIN_HEIGHT);\r\n  }\r\n\r\n  /** 合成事件 */\r\n  private mergeEvent(e: TouchEvent | MouseEvent) {\r\n    let mouseX = 0;\r\n    let mouseY = 0;\r\n    let mouseCX = 0;\r\n    let mouseCY = 0;\r\n    if (this.isMobile) {\r\n      const { clientX, clientY } = (e as TouchEvent).touches[0];\r\n      const target = e.target as HTMLCanvasElement;\r\n      const { left, top } = target.getBoundingClientRect();\r\n      mouseX = Math.round(clientX - left);\r\n      mouseY = Math.round(clientY - top);\r\n      if ((e as TouchEvent).touches.length === 2) {\r\n        const { clientX: clientX1 = 0, clientY: clientY1 = 0 } =\r\n          (e as TouchEvent).touches[1] || {};\r\n        mouseCX = Math.round(\r\n          Math.abs((clientX1 - clientX) / 2 + clientX) - left\r\n        );\r\n        mouseCY = Math.round(\r\n          Math.abs((clientY1 - clientY) / 2 + clientY) - top\r\n        );\r\n      }\r\n    } else {\r\n      mouseX = (e as MouseEvent).offsetX;\r\n      mouseY = (e as MouseEvent).offsetY;\r\n    }\r\n    return { ...e, mouseX, mouseY, mouseCX, mouseCY };\r\n  }\r\n\r\n  private handleLoad() {\r\n    this.emit(\"load\", this.image.src);\r\n    this.IMAGE_ORIGIN_WIDTH = this.IMAGE_WIDTH = this.image.width;\r\n    this.IMAGE_ORIGIN_HEIGHT = this.IMAGE_HEIGHT = this.image.height;\r\n    this.fitZoom();\r\n  }\r\n\r\n  private handleContextmenu(e: MouseEvent) {\r\n    e.preventDefault();\r\n    this.evt = e;\r\n    if (this.lock) return;\r\n  }\r\n\r\n  private handleMousewheel(e: WheelEvent) {\r\n    e.stopPropagation();\r\n    this.evt = e;\r\n    if (this.lock || !this.scrollZoom) return;\r\n    const { mouseX, mouseY } = this.mergeEvent(e);\r\n    this.mouse = [mouseX, mouseY];\r\n\r\n    if (\r\n      (e.deltaY > 0 && this.imageMin < this.MIN_LENGTH) ||\r\n      (e.deltaY < 0 && this.IMAGE_WIDTH > this.imageOriginMax * 10)\r\n    ) {\r\n      return;\r\n    } else {\r\n      if (e.deltaY < 0) {\r\n        this.textscaleStep++;\r\n      } else {\r\n        this.textscaleStep--;\r\n      }\r\n      this.setScale(e.deltaY < 0, true);\r\n    }\r\n  }\r\n\r\n  private handleMouseDown(e: MouseEvent | TouchEvent) {\r\n    e.stopPropagation();\r\n    this.evt = e;\r\n    if (this.lock) return;\r\n    const { mouseX, mouseY, mouseCX, mouseCY } = this.mergeEvent(e);\r\n    const offsetX = Math.round(mouseX / this.scale);\r\n    const offsetY = Math.round(mouseY / this.scale);\r\n    this.mouse =\r\n      this.isMobile && (e as TouchEvent).touches.length === 2\r\n        ? [mouseCX, mouseCY]\r\n        : [mouseX, mouseY];\r\n    this.remmberOrigin = [mouseX - this.originX, mouseY - this.originY];\r\n    // 记录变化前的数据\r\n    this.olddataset = deepClone(this.dataset);\r\n    if (\r\n      (!this.isMobile && (e as MouseEvent).buttons === 1) ||\r\n      (this.isMobile && (e as TouchEvent).touches.length === 1)\r\n    ) {\r\n      // 鼠标左键\r\n      const ctrls = this.activeShape.ctrlsData || [];\r\n      this.ctrlIndex = ctrls.findIndex((coor: Point) =>\r\n        this.isPointInCircle(this.mouse, coor, this.ctrlRadius)\r\n      );\r\n      this.clickIndex = this.ctrlIndex; // 记录选中的控制点索引，用于控制点加粗变红和编辑控制点\r\n      if (this.ctrlIndex > -1 && !this.readonly) {\r\n        // 点击到控制点\r\n        console.log(\"this.ctrlIndex\", this.ctrlIndex);\r\n        const [x0, y0] = ctrls[this.ctrlIndex];\r\n        if (\r\n          this.activeShape.type === Shape.Polygon &&\r\n          this.activeShape.coor.length > 2 &&\r\n          this.ctrlIndex === 0\r\n        ) {\r\n          this.handleDblclick(e);\r\n        } else {\r\n          this.update();\r\n        }\r\n        this.remmber = [[offsetX - x0, offsetY - y0]];\r\n      } else if (this.isInBackground(e)) {\r\n        if (this.activeShape.creating && !this.readonly) {\r\n          // 创建中\r\n          if ([Shape.Polygon, Shape.Line].includes(this.activeShape.type)) {\r\n            const [x, y] =\r\n              this.activeShape.coor[this.activeShape.coor.length - 1];\r\n            if (x !== offsetX && y !== offsetY) {\r\n              const nx = Math.round(offsetX - this.originX / this.scale);\r\n              const ny = Math.round(offsetY - this.originY / this.scale);\r\n              this.activeShape.coor.push([nx, ny]);\r\n            }\r\n          }\r\n        } else if (\r\n          this.createType !== Shape.None &&\r\n          !this.readonly &&\r\n          !this.isCtrlKey\r\n        ) {\r\n          // 开始创建\r\n          let newShape;\r\n          const nx = Math.round(offsetX - this.originX / this.scale);\r\n          const ny = Math.round(offsetY - this.originY / this.scale);\r\n          const curPoint: Point = [nx, ny];\r\n          switch (this.createType) {\r\n            case Shape.Rect:\r\n              newShape = new Rect(\r\n                { coor: [curPoint, curPoint] },\r\n                this.dataset.length\r\n              );\r\n              newShape.creating = true;\r\n              break;\r\n            case Shape.Polygon:\r\n              newShape = new Polygon({ coor: [curPoint] }, this.dataset.length);\r\n              newShape.creating = true;\r\n              break;\r\n            case Shape.Dot:\r\n              newShape = new Dot({ coor: curPoint }, this.dataset.length);\r\n              this.emit(\"add\", newShape);\r\n              break;\r\n            case Shape.Line:\r\n              newShape = new Line({ coor: [curPoint] }, this.dataset.length);\r\n              newShape.creating = true;\r\n              break;\r\n            case Shape.Circle:\r\n              newShape = new Circle({ coor: curPoint }, this.dataset.length);\r\n              newShape.creating = true;\r\n              break;\r\n            case Shape.Grid:\r\n              newShape = new Grid(\r\n                { coor: [curPoint, curPoint] },\r\n                this.dataset.length\r\n              );\r\n              newShape.creating = true;\r\n              break;\r\n            case Shape.Brush:\r\n              newShape = new Brush({ coor: [curPoint] }, this.dataset.length);\r\n              newShape.creating = true;\r\n              newShape.lineWidth = this.brushlineWidth;\r\n              newShape.strokeStyle = this.brushstrokeStyle;\r\n              this.ispainting = true;\r\n              if (this.isEraser) {\r\n                newShape.iseraser = true;\r\n                // this.ctx.save();\r\n                // this.ctx.globalCompositeOperation = 'destination-out';\r\n                // this.ctx.beginPath();\r\n                // this.ctx.arc(this.mouse[0], this.mouse[1], this.brushlineWidth / 2, 0, Math.PI * 2);\r\n                // this.ctx.fill();\r\n                // this.ctx.restore();\r\n                // this.lastX = this.mouse[0];\r\n                // this.lastY = this.mouse[1];\r\n              }\r\n              break;\r\n            case Shape.Pencil:\r\n              newShape = new Pencil({ coor: [curPoint] }, this.dataset.length);\r\n              newShape.creating = true;\r\n              newShape.lineWidth = this.pencillineWidth;\r\n              newShape.strokeStyle = this.pencilstrokeStyle;\r\n              this.ispainting = true;\r\n              break;\r\n            default:\r\n              break;\r\n          }\r\n          this.dataset.forEach((sp) => {\r\n            sp.active = false;\r\n          });\r\n          newShape.active = true;\r\n          this.dataset.push(newShape);\r\n        } else {\r\n          // 是否点击到形状\r\n          const [hitShapeIndex, hitShape] = this.hitOnShape(this.mouse);\r\n          if (hitShapeIndex > -1 && !hitShape.locking && !this.readonly) {\r\n            if (\r\n              hitShape.type === Shape.Dot &&\r\n              \"color\" in hitShape &&\r\n              hitShape.color !== \"\"\r\n            ) {\r\n              return; // 智能标注生成的点不可被选中\r\n            }\r\n            if (hitShape.type === Shape.Brush) {\r\n              if (\"iseraser\" in hitShape && !hitShape.iseraser) {\r\n                this.dataset.forEach(\r\n                  (item, i) => (item.active = i === hitShapeIndex)\r\n                );\r\n                // if (this.activeShape.boundingRect.length === 0) {\r\n                //   this.activeShape.boundingRect = this.removeDuplicatePoints(\r\n                //     hitShape.coor,\r\n                //     true,\r\n                //     false\r\n                //   ).resultRect;\r\n                // }\r\n                this.emit(\"select\", hitShape);\r\n              }\r\n              return; // 刷子、橡皮檫和钢笔轨迹不可被拖拽\r\n            }\r\n            if (hitShape.type === Shape.Pencil) {\r\n              this.dataset.forEach(\r\n                (item, i) => (item.active = i === hitShapeIndex)\r\n              );\r\n              // if (this.activeShape.boundingRect.length === 0) {\r\n              //   this.activeShape.boundingRect = this.removeDuplicatePoints(\r\n              //     hitShape.coor,\r\n              //     true,\r\n              //     false\r\n              //   ).resultRect;\r\n              // }\r\n              this.emit(\"select\", hitShape);\r\n              this.update();\r\n              return; // 刷子、橡皮檫和钢笔轨迹不可被拖拽\r\n            }\r\n            // if(hitShape.type === Shape.Mask){\r\n            //     hitShape.active = true;\r\n            //     this.highlightMask(hitShapeIndex);\r\n            //     return; // 刷子、橡皮檫和钢笔轨迹不可被拖拽\r\n            // }\r\n            hitShape.dragging = true;\r\n            this.dataset.forEach(\r\n              (item, i) => (item.active = i === hitShapeIndex)\r\n            );\r\n            this.dataset.splice(hitShapeIndex, 1, hitShape);\r\n            // this.dataset.push(hitShape);\r\n            if (!this.readonly) {\r\n              this.remmber = [];\r\n              if ([Shape.Dot, Shape.Circle].includes(hitShape.type)) {\r\n                const [x, y] = hitShape.coor;\r\n                this.remmber = [[offsetX - x, offsetY - y]];\r\n              } else {\r\n                hitShape.coor.forEach((pt: any) => {\r\n                  this.remmber.push([offsetX - pt[0], offsetY - pt[1]]);\r\n                });\r\n              }\r\n            }\r\n            this.emit(\"select\", hitShape);\r\n          } else {\r\n            this.activeShape.active = false;\r\n            this.dataset.sort((a, b) => a.index - b.index);\r\n            this.emit(\"select\", null);\r\n          }\r\n        }\r\n        this.update();\r\n      } else {\r\n        this.activeShape.active = false;\r\n        this.dataset.sort((a, b) => a.index - b.index);\r\n        this.emit(\"select\", null);\r\n        this.update();\r\n      }\r\n    } else if (\r\n      (!this.isMobile && (e as MouseEvent).buttons === 2) ||\r\n      (this.isMobile &&\r\n        (e as TouchEvent).touches.length === 3 &&\r\n        !this.readonly)\r\n    ) {\r\n      // 鼠标右键\r\n      if ([Shape.Grid].includes(this.activeShape.type) && this.gridMenuEnable) {\r\n        const rowCol = prompt(\r\n          \"x 行 y 列 x,y\",\r\n          [this.activeShape.row, this.activeShape.col].join(\",\")\r\n        );\r\n        if (typeof rowCol === \"string\") {\r\n          const [row, col] = rowCol.split(\",\");\r\n          if (/^[1-9]\\d*$/.test(row) && /^[1-9]\\d*$/.test(col)) {\r\n            this.activeShape.row = Number(row);\r\n            this.activeShape.col = Number(col);\r\n            this.update();\r\n          }\r\n        }\r\n      }\r\n      this.emit(\"contextmenu\", e);\r\n    }\r\n  }\r\n\r\n  private handleMouseMove(e: MouseEvent | TouchEvent) {\r\n    e.stopPropagation();\r\n    this.evt = e;\r\n    if (this.lock) return;\r\n    const { mouseX, mouseY, mouseCX, mouseCY } = this.mergeEvent(e);\r\n    const offsetX = Math.round(mouseX / this.scale);\r\n    const offsetY = Math.round(mouseY / this.scale);\r\n    this.mouse =\r\n      this.isMobile && (e as TouchEvent).touches.length === 2\r\n        ? [mouseCX, mouseCY]\r\n        : [mouseX, mouseY];\r\n    if (\r\n      ((!this.isMobile && (e as MouseEvent).buttons === 1) ||\r\n        (this.isMobile && (e as TouchEvent).touches.length === 1)) &&\r\n      this.activeShape.type\r\n    ) {\r\n      if (\r\n        this.ctrlIndex > -1 &&\r\n        this.remmber.length &&\r\n        (this.isInBackground(e) || this.activeShape.type === Shape.Circle)\r\n      ) {\r\n        const [[x, y]] = this.remmber;\r\n        // resize矩形\r\n        if ([Shape.Rect, Shape.Grid].includes(this.activeShape.type)) {\r\n          const [[x0, y0], [x1, y1]] = this.activeShape.coor;\r\n          let coor: Point[] = [];\r\n          switch (this.ctrlIndex) {\r\n            case 0:\r\n              coor = [\r\n                [offsetX - x, offsetY - y],\r\n                [x1, y1]\r\n              ];\r\n              break;\r\n            case 1:\r\n              coor = [\r\n                [x0, offsetY - y],\r\n                [x1, y1]\r\n              ];\r\n              break;\r\n            case 2:\r\n              coor = [\r\n                [x0, offsetY - y],\r\n                [offsetX - x, y1]\r\n              ];\r\n              break;\r\n            case 3:\r\n              coor = [\r\n                [x0, y0],\r\n                [offsetX - x, y1]\r\n              ];\r\n              break;\r\n            case 4:\r\n              coor = [\r\n                [x0, y0],\r\n                [offsetX - x, offsetY - y]\r\n              ];\r\n              break;\r\n            case 5:\r\n              coor = [\r\n                [x0, y0],\r\n                [x1, offsetY - y]\r\n              ];\r\n              break;\r\n            case 6:\r\n              coor = [\r\n                [offsetX - x, y0],\r\n                [x1, offsetY - y]\r\n              ];\r\n              break;\r\n            case 7:\r\n              coor = [\r\n                [offsetX - x, y0],\r\n                [x1, y1]\r\n              ];\r\n              break;\r\n            default:\r\n              break;\r\n          }\r\n          let [[a0, b0], [a1, b1]] = coor;\r\n          if (\r\n            a0 < 0 ||\r\n            a1 < 0 ||\r\n            b0 < 0 ||\r\n            b1 < 0 ||\r\n            a1 > this.IMAGE_ORIGIN_WIDTH ||\r\n            b1 > this.IMAGE_ORIGIN_HEIGHT\r\n          ) {\r\n            // 偶然触发 超出边界处理\r\n            a0 < 0 && (a0 = 0);\r\n            a1 < 0 && (a1 = 0);\r\n            b0 < 0 && (b0 = 0);\r\n            b1 < 0 && (b1 = 0);\r\n            if (a1 > this.IMAGE_ORIGIN_WIDTH) {\r\n              a1 = this.IMAGE_ORIGIN_WIDTH;\r\n            }\r\n            if (b1 > this.IMAGE_ORIGIN_HEIGHT) {\r\n              b1 = this.IMAGE_ORIGIN_HEIGHT;\r\n            }\r\n          }\r\n\r\n          if (a1 - a0 >= this.MIN_WIDTH && b1 - b0 >= this.MIN_HEIGHT) {\r\n            this.activeShape.coor = [\r\n              [a0, b0],\r\n              [a1, b1]\r\n            ];\r\n          } else {\r\n            this.emit(\r\n              \"warn\",\r\n              `Width cannot be less than ${this.MIN_WIDTH},Height cannot be less than${this.MIN_HEIGHT}。`\r\n            );\r\n          }\r\n        } else if (\r\n          [Shape.Polygon, Shape.Line].includes(this.activeShape.type)\r\n        ) {\r\n          const nx = Math.round(offsetX - this.originX / this.scale);\r\n          const ny = Math.round(offsetY - this.originY / this.scale);\r\n          const newPoint = [nx, ny];\r\n          this.activeShape.coor.splice(this.ctrlIndex, 1, newPoint); // 修改点坐标\r\n        } else if (this.activeShape.type === Shape.Circle) {\r\n          const nx = Math.round(offsetX - this.originX / this.scale);\r\n          const newRadius = nx - this.activeShape.coor[0];\r\n          if (newRadius >= this.MIN_RADIUS) this.activeShape.radius = newRadius;\r\n        }\r\n      } else if (this.activeShape.dragging && !this.readonly) {\r\n        // 拖拽\r\n        let coor = [];\r\n        let noLimit = true;\r\n        const w = this.IMAGE_ORIGIN_WIDTH || this.WIDTH;\r\n        const h = this.IMAGE_ORIGIN_HEIGHT || this.HEIGHT;\r\n        if ([Shape.Dot, Shape.Circle].includes(this.activeShape.type)) {\r\n          const [t1, t2] = this.remmber[0];\r\n          const x = offsetX - t1;\r\n          const y = offsetY - t2;\r\n          if (x < 0 || x > w || y < 0 || y > h) noLimit = false;\r\n          coor = [x, y];\r\n        } else {\r\n          for (let i = 0; i < this.activeShape.coor.length; i++) {\r\n            const tar = this.remmber[i];\r\n            const x = offsetX - tar[0];\r\n            const y = offsetY - tar[1];\r\n            if (x < 0 || x > w || y < 0 || y > h) noLimit = false;\r\n            coor.push([x, y]);\r\n          }\r\n        }\r\n        if (noLimit) this.activeShape.coor = coor;\r\n      } else if (this.activeShape.creating && this.isInBackground(e)) {\r\n        const x = Math.round(offsetX - this.originX / this.scale);\r\n        const y = Math.round(offsetY - this.originY / this.scale);\r\n        // 创建矩形\r\n        if ([Shape.Rect, Shape.Grid].includes(this.activeShape.type)) {\r\n          this.activeShape.coor.splice(1, 1, [x, y]);\r\n        } else if (this.activeShape.type === Shape.Circle) {\r\n          const [x0, y0] = this.activeShape.coor;\r\n          const r = Math.sqrt((x0 - x) ** 2 + (y0 - y) ** 2);\r\n          this.activeShape.radius = r;\r\n        } else if (this.ispainting && this.createType === Shape.Brush) {\r\n          const nx = Math.round(offsetX - this.originX / this.scale);\r\n          const ny = Math.round(offsetY - this.originY / this.scale);\r\n          const newPoint: Point = [nx, ny];\r\n          this.activeShape.coor.push(newPoint);\r\n        } else if (this.ispainting && this.createType === Shape.Pencil) {\r\n          const nx = Math.round(offsetX - this.originX / this.scale);\r\n          const ny = Math.round(offsetY - this.originY / this.scale);\r\n          const newPoint: Point = [nx, ny];\r\n          this.activeShape.coor.push(newPoint);\r\n        }\r\n      }\r\n      this.update();\r\n    } else if (\r\n      [Shape.Polygon, Shape.Line, Shape.Brush, Shape.Pencil].includes(\r\n        this.activeShape.type\r\n      ) &&\r\n      this.activeShape.creating\r\n    ) {\r\n      // 多边形添加点\r\n      this.update();\r\n    } else if (\r\n      (!this.isMobile &&\r\n        (e as MouseEvent).buttons === 2 &&\r\n        (e as MouseEvent).which === 3) ||\r\n      (this.isMobile &&\r\n        (e as TouchEvent).touches.length === 1 &&\r\n        !this.isTouch2)\r\n    ) {\r\n      // 拖动背景\r\n      this.originX = Math.round(mouseX - this.remmberOrigin[0]);\r\n      this.originY = Math.round(mouseY - this.remmberOrigin[1]);\r\n      this.emit(\"dragimg\");\r\n      this.update();\r\n    } else if (this.isMobile && (e as TouchEvent).touches.length === 2) {\r\n      this.isTouch2 = true;\r\n      const touch0 = (e as TouchEvent).touches[0];\r\n      const touch1 = (e as TouchEvent).touches[1];\r\n      const cur = this.scaleTouchStore;\r\n      this.scaleTouchStore = Math.abs(\r\n        (touch1.clientX - touch0.clientX) * (touch1.clientY - touch0.clientY)\r\n      );\r\n      this.setScale(this.scaleTouchStore > cur, true);\r\n    }\r\n  }\r\n\r\n  private handleMouseUp(e: MouseEvent | TouchEvent) {\r\n    console.log(\"handleMouseUp\");\r\n    e.stopPropagation();\r\n    this.evt = e;\r\n    if (this.lock) return;\r\n    if (this.isMobile) {\r\n      if ((e as TouchEvent).touches.length === 0) {\r\n        this.isTouch2 = false;\r\n      }\r\n      if (Date.now() - this.dblTouchStore < this.dblTouch) {\r\n        this.handleDblclick(e);\r\n        return;\r\n      }\r\n      this.dblTouchStore = Date.now();\r\n    }\r\n    this.remmber = [];\r\n    if (this.activeShape.type !== Shape.None && !this.isCtrlKey) {\r\n      // if (this.activeShape.dragging) {\r\n      //   this.activeShape.truncated = 0;\r\n      //   for (let i = 0; i < this.dataset.length; i++) {\r\n      //     if (\r\n      //       this.dataset[i].type === Shape.Rect &&\r\n      //       this.dataset[i].index !== this.activeShape.index\r\n      //     ) {\r\n      //       if (\r\n      //         this.dataset[i].coor[1][0] > this.activeShape.coor[0][0] &&\r\n      //         this.dataset[i].coor[0][0] < this.activeShape.coor[1][0] &&\r\n      //         this.dataset[i].coor[1][1] > this.activeShape.coor[0][1] &&\r\n      //         this.dataset[i].coor[0][1] < this.activeShape.coor[1][1]\r\n      //       ) {\r\n      //         this.activeShape.truncated = 1;\r\n      //       }\r\n      //     }\r\n      //   }\r\n      // }\r\n      this.activeShape.dragging = false;\r\n      if (this.activeShape.creating) {\r\n        if ([Shape.Rect, Shape.Grid].includes(this.activeShape.type)) {\r\n          const [[x0, y0], [x1, y1]] = this.activeShape.coor;\r\n          if (\r\n            Math.abs(x0 - x1) < this.MIN_WIDTH ||\r\n            Math.abs(y0 - y1) < this.MIN_HEIGHT\r\n          ) {\r\n            this.dataset.pop();\r\n            this.emit(\r\n              \"warn\",\r\n              `Width cannot be less than ${this.MIN_WIDTH},Height cannot be less than ${this.MIN_HEIGHT}`\r\n            );\r\n          } else {\r\n            this.activeShape.coor = [\r\n              [Math.min(x0, x1), Math.min(y0, y1)],\r\n              [Math.max(x0, x1), Math.max(y0, y1)]\r\n            ];\r\n            this.activeShape.creating = false;\r\n            this.activeShape.truncated = 0;\r\n            for (let i = 0; i < this.dataset.length; i++) {\r\n              if (\r\n                this.dataset[i].type === Shape.Rect &&\r\n                this.dataset[i].index !== this.activeShape.index\r\n              ) {\r\n                if (\r\n                  this.dataset[i].coor[1][0] > this.activeShape.coor[0][0] &&\r\n                  this.dataset[i].coor[0][0] < this.activeShape.coor[1][0] &&\r\n                  this.dataset[i].coor[1][1] > this.activeShape.coor[0][1] &&\r\n                  this.dataset[i].coor[0][1] < this.activeShape.coor[1][1]\r\n                ) {\r\n                  this.activeShape.truncated = 1;\r\n                }\r\n              }\r\n            }\r\n            this.emit(\"add\", this.activeShape);\r\n          }\r\n        } else if (this.activeShape.type === Shape.Circle) {\r\n          if (this.activeShape.radius < this.MIN_RADIUS) {\r\n            this.dataset.pop();\r\n            this.emit(\"warn\", `Radius cannot be less than ${this.MIN_WIDTH}`);\r\n          } else {\r\n            this.activeShape.creating = false;\r\n            this.emit(\"add\", this.activeShape);\r\n          }\r\n        } else if (this.createType === Shape.Brush) {\r\n          if (this.activeShape.coor.length < this.MIN_POINTNUM) {\r\n            this.dataset.pop();\r\n            this.emit(\r\n              \"warn\",\r\n              `Path points cannot be less than ${this.MIN_POINTNUM}`\r\n            );\r\n          } else {\r\n            this.ispainting = false;\r\n            this.activeShape.creating = false;\r\n            // 去除重复点\r\n            const { resultCoor, resultRect } = this.removeDuplicatePoints(\r\n              this.activeShape.coor,\r\n              true\r\n            );\r\n            this.activeShape.coor = resultCoor;\r\n            this.activeShape.boundingRect = resultRect;\r\n            this.emit(\"add\", this.activeShape);\r\n          }\r\n        } else if (this.createType === Shape.Pencil) {\r\n          if (this.activeShape.coor.length < this.MIN_POINTNUM) {\r\n            this.dataset.pop();\r\n            this.emit(\r\n              \"warn\",\r\n              `Path points cannot be less than ${this.MIN_POINTNUM}`\r\n            );\r\n          } else {\r\n            this.activeShape.coor.push([-1, -1]);\r\n            this.ispainting = false;\r\n            this.activeShape.creating = false;\r\n            // 去除重复点\r\n            const { resultCoor, resultRect } = this.removeDuplicatePoints(\r\n              this.activeShape.coor,\r\n              true\r\n            );\r\n            this.activeShape.coor = resultCoor;\r\n            this.activeShape.boundingRect = resultRect;\r\n            this.emit(\"add\", this.activeShape);\r\n          }\r\n        } else if (this.createType === Shape.Line) {\r\n          if (this.activeShape.coor.length === this.maxLinePointCount) {\r\n            const canLine =\r\n              this.activeShape.type === Shape.Line &&\r\n              this.activeShape.coor.length > 1;\r\n            if (canLine) {\r\n              this.emit(\"add\", this.activeShape);\r\n              this.activeShape.creating = false;\r\n            }\r\n          }\r\n        }\r\n        this.update();\r\n      }\r\n      const condition = [\r\n        \"coor\",\r\n        \"label\",\r\n        \"labelUp\",\r\n        \"lineWidth\",\r\n        \"strokeStyle\",\r\n        \"textFillStyle\",\r\n        \"uuid\",\r\n        \"remark\",\r\n        \"length\"\r\n      ];\r\n      // console.log(deepEqual(this.olddataset, this.dataset, condition));\r\n      // console.log(\"this.olddataset\", this.olddataset);\r\n      // console.log(\"this.dataset\", this.dataset);\r\n      if (!deepEqual(this.olddataset, this.dataset, condition)) {\r\n        this.manageDoneList(deepClone(this.dataset));\r\n        console.log(\"this.doneList\", this.doneList);\r\n      }\r\n    }\r\n  }\r\n\r\n  private handleDblclick(e: MouseEvent | TouchEvent) {\r\n    e.stopPropagation();\r\n    this.evt = e;\r\n    if (this.lock) return;\r\n    if ([Shape.Polygon, Shape.Line].includes(this.activeShape.type)) {\r\n      const canPolygon =\r\n        this.activeShape.type === Shape.Polygon &&\r\n        this.activeShape.coor.length > 2;\r\n      const canLine =\r\n        this.activeShape.type === Shape.Line &&\r\n        this.activeShape.coor.length > 1;\r\n      if (canPolygon || canLine) {\r\n        this.emit(\"add\", this.activeShape);\r\n        this.activeShape.creating = false;\r\n        this.update();\r\n      }\r\n    } else if ([Shape.Grid].includes(this.activeShape.type)) {\r\n      // 双击切换网格分区选中状态\r\n      if (this.activeShape.active) {\r\n        this.activeShape.gridRects.forEach(\r\n          (rect: { coor: Point[]; index: number }) => {\r\n            if (this.isPointInRect(this.mouse, rect.coor)) {\r\n              const thisIndex = this.activeShape.selected.findIndex(\r\n                (x: number) => rect.index === x\r\n              );\r\n              if (thisIndex > -1) {\r\n                this.activeShape.selected.splice(thisIndex, 1);\r\n              } else {\r\n                this.activeShape.selected.push(rect.index);\r\n              }\r\n            }\r\n          }\r\n        );\r\n        this.update();\r\n      }\r\n    }\r\n  }\r\n  private handleKeydown(e: KeyboardEvent) {\r\n    if (e.code === this.ctrlCode) {\r\n      this.isCtrlKey = true;\r\n    }\r\n  }\r\n\r\n  private handleKeyup(e: KeyboardEvent) {\r\n    if (e.code === this.ctrlCode) {\r\n      this.isCtrlKey = false;\r\n    }\r\n    this.evt = e;\r\n    // 检查是否按下了 Ctrl + V\r\n    if (this.isCtrlKey && e.key === \"v\" && !this.readonly) {\r\n      this.copyByIndex(this.activeShape.index);\r\n      return; // 直接返回，防止执行后续代码\r\n    }\r\n    if (this.lock || document.activeElement !== document.body || this.readonly)\r\n      return;\r\n    if (this.activeShape.type) {\r\n      if (\r\n        [Shape.Polygon, Shape.Line].includes(this.activeShape.type) &&\r\n        e.key === \"Escape\"\r\n      ) {\r\n        if (this.activeShape.coor.length > 1 && this.activeShape.creating) {\r\n          this.activeShape.coor.pop();\r\n        } else {\r\n          this.deleteByIndex(this.activeShape.index);\r\n        }\r\n        this.update();\r\n      } else if (e.key === \"Backspace\" || e.key === \"Delete\") {\r\n        this.deleteByIndex(this.activeShape.index);\r\n      }\r\n    }\r\n  }\r\n\r\n  /** 初始化配置 */\r\n  initSetting() {\r\n    const dpr = window.devicePixelRatio || 1;\r\n    this.canvas.style.userSelect = \"none\";\r\n    this.ctx =\r\n      this.ctx ||\r\n      this.canvas.getContext(\"2d\", {\r\n        alpha: this.alpha,\r\n        willReadFrequently: true\r\n      });\r\n    this.WIDTH = Math.round(this.canvas.clientWidth);\r\n    this.HEIGHT = Math.round(this.canvas.clientHeight);\r\n    this.canvas.width = this.WIDTH * dpr;\r\n    this.canvas.height = this.HEIGHT * dpr;\r\n    this.canvas.style.width = this.WIDTH + \"px\";\r\n    this.canvas.style.height = this.HEIGHT + \"px\";\r\n    this.offScreen.width = this.WIDTH;\r\n    this.offScreen.height = this.HEIGHT;\r\n    this.offScreenCtx =\r\n      this.offScreenCtx ||\r\n      this.offScreen.getContext(\"2d\", { willReadFrequently: true });\r\n    this.ctx.scale(dpr, dpr);\r\n  }\r\n\r\n  /** 初始化事件 */\r\n  initEvents() {\r\n    if (!this.canvas) return;\r\n    this.image.addEventListener(\"load\", this.handleLoad);\r\n    this.canvas.addEventListener(\"touchstart\", this.handleMouseDown);\r\n    this.canvas.addEventListener(\"touchmove\", this.handleMouseMove);\r\n    this.canvas.addEventListener(\"touchend\", this.handleMouseUp);\r\n    this.canvas.addEventListener(\"contextmenu\", this.handleContextmenu);\r\n    this.canvas.addEventListener(\"mousewheel\", this.handleMousewheel); // 火狐浏览器不支持mousewheel事件\r\n    this.canvas.removeEventListener(\"wheel\", this.handleMousewheel); // 解决火狐浏览器不支持mousewheel事件的问题\r\n    this.canvas.addEventListener(\"mousedown\", this.handleMouseDown);\r\n    this.canvas.addEventListener(\"mousemove\", this.handleMouseMove);\r\n    this.canvas.addEventListener(\"mouseup\", this.handleMouseUp);\r\n    this.canvas.addEventListener(\"dblclick\", this.handleDblclick);\r\n    document.body.addEventListener(\"keydown\", this.handleKeydown, true);\r\n    document.body.addEventListener(\"keyup\", this.handleKeyup, true);\r\n  }\r\n\r\n  getscaledPoint(e: MouseEvent): Point {\r\n    const { mouseX, mouseY } = this.mergeEvent(e);\r\n    const offsetX = Math.round(mouseX / this.scale);\r\n    const offsetY = Math.round(mouseY / this.scale);\r\n    const nx = Math.round(offsetX - this.originX / this.scale);\r\n    const ny = Math.round(offsetY - this.originY / this.scale);\r\n    return [nx, ny];\r\n  }\r\n\r\n  /**\r\n   * 添加/切换图片\r\n   * @param url 图片链接\r\n   */\r\n  setImage(url: string, alpha: number = 1) {\r\n    // 解决问题：Failed to execute 'toDataURL' on 'HTMLCanvasElement': Tainted canvases may not be exported.\r\n    this.image.crossOrigin = \"Anonymous\";\r\n    this.image.src = url;\r\n    this.imagealpha = alpha;\r\n    this.scaleStep = 0;\r\n    this.textscaleStep = 0;\r\n  }\r\n\r\n  // 异步处理 Mask 形状的创建\r\n  async handleMaskShape(\r\n    item: AllShape,\r\n    index: number\r\n  ): Promise<AllShape | null> {\r\n    let tempshape = new Mask(item, index);\r\n    const maskBase64 = tempshape.maskBase64;\r\n    const maskImage = new Image();\r\n    maskImage.crossOrigin = \"Anonymous\";\r\n    maskImage.src = `data:image/png;base64,${maskBase64}`;\r\n\r\n    return new Promise((resolve, reject) => {\r\n      maskImage.onload = () => {\r\n        const pixels: number[] = [];\r\n        const pixelData = this.getImagedataFromImageClass(maskImage, \"magic\");\r\n\r\n        if (pixelData) {\r\n          // 遍历像素，筛选符合条件的像素点\r\n          for (let i = 0; i < pixelData.length; i += 4) {\r\n            if (\r\n              pixelData[i] === 255 &&\r\n              pixelData[i + 1] === 255 &&\r\n              pixelData[i + 2] === 255\r\n            ) {\r\n              pixels.push(i);\r\n            }\r\n          }\r\n\r\n          tempshape.pixels = pixels;\r\n          tempshape.height = this.IMAGE_HEIGHT;\r\n          tempshape.weight = this.IMAGE_WIDTH;\r\n          tempshape.fillStyle = item.fillStyle;\r\n          tempshape.strokeStyle = item.strokeStyle;\r\n\r\n          // 根据 'maskToPolygon' 判断是否转换为 Polygon 形状\r\n          if (\r\n            \"maskToPolygon\" in item &&\r\n            item.maskToPolygon &&\r\n            tempshape.maskType === \"click\"\r\n          ) {\r\n            this.activeCanvasData = this.putDataOnCanvas(\r\n              this.canvas,\r\n              pixels,\r\n              tempshape.fillStyle,\r\n              false\r\n            );\r\n            const polygonShape = new Polygon(\r\n              {\r\n                coor: this.getContourPointsOfColoredRegion(\r\n                  this.activeCanvasData,\r\n                  0.5\r\n                )\r\n              },\r\n              index\r\n            );\r\n            polygonShape.tagId = item.tagId;\r\n            polygonShape.label = item.label;\r\n            polygonShape.strokeStyle = item.strokeStyle;\r\n            this.activePolygon = polygonShape.uuid;\r\n            resolve(polygonShape);\r\n          } else {\r\n            tempshape.canvasData = this.putDataOnCanvas(\r\n              this.canvas,\r\n              pixels,\r\n              tempshape.fillStyle,\r\n              true\r\n            );\r\n            tempshape.tagId = item.tagId;\r\n            tempshape.label = item.label;\r\n            resolve(tempshape);\r\n          }\r\n\r\n          // 绘制样本点\r\n          this.magicPoints = tempshape.magicPoints;\r\n        } else {\r\n          console.error(\"Failed to get pixel data from mask image\");\r\n          reject(null); // 如果加载像素数据失败，返回 null\r\n        }\r\n      };\r\n\r\n      maskImage.onerror = (err) => {\r\n        console.error(\"Error loading mask image\", err);\r\n        reject(null); // 如果加载图像失败，返回 null\r\n      };\r\n    });\r\n  }\r\n\r\n  /**\r\n   * 设置数据\r\n   * @param data Array\r\n   * @param needCreate Boolean 是否需要创建(当传options时需要，当撤销重做操作传dataset时不需要)\r\n   */\r\n  setData(\r\n    data: AllShape[],\r\n    needCreate: boolean = true,\r\n    toMask: boolean = false,\r\n    initSize: boolean = false\r\n  ): Promise<void> {\r\n    return new Promise((resolve) => {\r\n      setTimeout(async () => {\r\n        if (needCreate) {\r\n          const initdata: AllShape[] = [];\r\n          const itemIndexMap = new Map<AllShape, number>();\r\n\r\n          data.forEach((item, index) => {\r\n            itemIndexMap.set(item, index);\r\n          });\r\n\r\n          for (const item of data) {\r\n            if (Object.prototype.toString.call(item).includes(\"Object\")) {\r\n              let shape;\r\n              const index = itemIndexMap.get(item)!;\r\n\r\n              switch (item.type) {\r\n                case Shape.Rect:\r\n                  shape = new Rect(item, index);\r\n                  break;\r\n                case Shape.Polygon:\r\n                  shape = new Polygon(item, index);\r\n                  break;\r\n                case Shape.Dot:\r\n                  shape = new Dot(item, index);\r\n                  break;\r\n                case Shape.Line:\r\n                  shape = new Line(item, index);\r\n                  break;\r\n                case Shape.Circle:\r\n                  shape = new Circle(item, index);\r\n                  break;\r\n                case Shape.Grid:\r\n                  shape = new Grid(item, index);\r\n                  break;\r\n                case Shape.Brush:\r\n                  shape = new Brush(item, index);\r\n                  break;\r\n                case Shape.Mask:\r\n                  shape = await this.handleMaskShape(item, index);\r\n                  break;\r\n                case Shape.Pencil:\r\n                  shape = new Pencil(item, index);\r\n                  break;\r\n                default:\r\n                  console.warn(\"Invalid shape\", item);\r\n                  break;\r\n              }\r\n\r\n              if (\r\n                [\r\n                  Shape.Rect,\r\n                  Shape.Polygon,\r\n                  Shape.Dot,\r\n                  Shape.Line,\r\n                  Shape.Circle,\r\n                  Shape.Grid,\r\n                  Shape.Brush,\r\n                  Shape.Mask,\r\n                  Shape.Pencil\r\n                ].includes(item.type)\r\n              ) {\r\n                initdata.push(shape);\r\n              }\r\n            } else {\r\n              console.warn(\"Shape must be an enumerable Object.\", item);\r\n            }\r\n          }\r\n\r\n          this.dataset = initdata;\r\n        } else {\r\n          this.dataset = data;\r\n        }\r\n\r\n        this.update(toMask, initSize);\r\n\r\n        if (this.doneList.length === 0 && this.dataset !== undefined) {\r\n          this.manageDoneList(deepClone(this.dataset));\r\n        }\r\n\r\n        resolve(); // ✅ 完成后 resolve promise\r\n      }, 0); // 使用 setTimeout 模拟 nextTick，防止阻塞主线程\r\n    });\r\n  }\r\n\r\n  /**\r\n   * 判断是否在标注实例上\r\n   * @param mousePoint 点击位置\r\n   * @returns\r\n   */\r\n  hitOnShape(mousePoint: Point): [number, AllShape] {\r\n    let hitShapeIndex = -1;\r\n    let hitShape: AllShape;\r\n    for (let i = this.dataset.length - 1; i > -1; i--) {\r\n      const shape = this.dataset[i];\r\n      if (\r\n        this.isPointInBackground(mousePoint) &&\r\n        ((shape.type === Shape.Dot &&\r\n          this.isPointInCircle(\r\n            mousePoint,\r\n            shape.coor as Point,\r\n            this.ctrlRadius\r\n          )) ||\r\n          (shape.type === Shape.Circle &&\r\n            this.isPointInCircle(\r\n              mousePoint,\r\n              shape.coor as Point,\r\n              (shape as Circle).radius * this.scale\r\n            )) ||\r\n          (shape.type === Shape.Rect &&\r\n            this.isPointInRect(mousePoint, (shape as Rect).coor)) ||\r\n          (shape.type === Shape.Polygon &&\r\n            this.isPointInPolygon(mousePoint, (shape as Polygon).coor)) ||\r\n          (shape.type === Shape.Line &&\r\n            this.isPointInLine(mousePoint, (shape as Line).coor)) ||\r\n          (shape.type === Shape.Grid &&\r\n            this.isPointInRect(mousePoint, (shape as Grid).coor)) ||\r\n          (shape.type === Shape.Brush &&\r\n            this.isPointInLine(mousePoint, (shape as Brush).coor)) ||\r\n          (shape.type === Shape.Pencil &&\r\n            this.isPointInPolygon(mousePoint, (shape as Pencil).coor)) ||\r\n          (shape.type === Shape.Mask &&\r\n            this.isMouseInPixelsRegion(mousePoint, (shape as Mask).canvasData)))\r\n      ) {\r\n        if ((this.focusMode && !shape.active) || shape.hiddening) continue;\r\n        hitShapeIndex = i;\r\n        hitShape = shape;\r\n        break;\r\n      }\r\n    }\r\n    return [hitShapeIndex, hitShape];\r\n  }\r\n\r\n  /**\r\n   * 判断是否在标注实例顶点上\r\n   * @param mousePoint 点击位置\r\n   * @returns\r\n   */\r\n  hitOnShapeVertex(): string {\r\n    let mouseType: string;\r\n    const shape = this.activeShape;\r\n    const ctrls = this.activeShape.ctrlsData || [];\r\n    this.ctrlIndex = ctrls.findIndex((coor: Point) =>\r\n      this.isPointInCircle(this.mouse, coor, this.ctrlRadius)\r\n    );\r\n    if (this.ctrlIndex > -1 && !this.readonly && !shape.hiddening) {\r\n      if (shape.type === Shape.Rect) {\r\n        if (this.ctrlIndex === 0) {\r\n          mouseType = \"nw-resize\";\r\n        } else if (this.ctrlIndex === 1) {\r\n          mouseType = \"ns-resize\";\r\n        } else if (this.ctrlIndex === 2) {\r\n          mouseType = \"ne-resize\";\r\n        } else if (this.ctrlIndex === 3) {\r\n          mouseType = \"ew-resize\";\r\n        } else if (this.ctrlIndex === 4) {\r\n          mouseType = \"se-resize\";\r\n        } else if (this.ctrlIndex === 5) {\r\n          mouseType = \"ns-resize\";\r\n        } else if (this.ctrlIndex === 6) {\r\n          mouseType = \"sw-resize\";\r\n        } else {\r\n          mouseType = \"ew-resize\";\r\n        }\r\n      } else if (\r\n        shape.type === Shape.Brush ||\r\n        shape.type === Shape.Pencil ||\r\n        shape.type === Shape.Polygon ||\r\n        shape.type === Shape.Line ||\r\n        shape.type === Shape.Circle\r\n      ) {\r\n        mouseType = \"pointer\";\r\n      } else {\r\n        mouseType = \"move\";\r\n      }\r\n    } else {\r\n      mouseType = \"\";\r\n    }\r\n    return mouseType;\r\n  }\r\n\r\n  /**\r\n   * 判断鼠标是否在背景图内部\r\n   * @param e MouseEvent\r\n   * @returns 布尔值\r\n   */\r\n  isInBackground(e: MouseEvent | TouchEvent): boolean {\r\n    const { mouseX, mouseY } = this.mergeEvent(e);\r\n    return (\r\n      mouseX >= this.originX &&\r\n      mouseY >= this.originY &&\r\n      mouseX <= this.originX + this.IMAGE_ORIGIN_WIDTH * this.scale &&\r\n      mouseY <= this.originY + this.IMAGE_ORIGIN_HEIGHT * this.scale\r\n    );\r\n  }\r\n\r\n  /**point\r\n   * 判断点是否在背景图内部\r\n   * @param point Point\r\n   * @returns 布尔值\r\n   */\r\n  isPointInBackground(point: Point): boolean {\r\n    const pointX = point[0]; //???????????????\r\n    const pointY = point[1];\r\n    return (\r\n      pointX >= this.originX &&\r\n      pointY >= this.originY &&\r\n      pointX <= this.originX + this.IMAGE_ORIGIN_WIDTH * this.scale &&\r\n      pointY <= this.originY + this.IMAGE_ORIGIN_HEIGHT * this.scale\r\n    );\r\n  }\r\n\r\n  /**\r\n   * 判断是否在矩形内\r\n   * @param point 坐标\r\n   * @param coor 区域坐标\r\n   * @returns 布尔值\r\n   */\r\n  isPointInRect(point: Point, coor: Point[]): boolean {\r\n    const [x, y] = point;\r\n    const [[x0, y0], [x1, y1]] = coor.map((a) => a.map((b) => b * this.scale));\r\n    return (\r\n      x0 + this.originX < x &&\r\n      x < x1 + this.originX &&\r\n      y0 + this.originY < y &&\r\n      y < y1 + this.originY\r\n    );\r\n  }\r\n\r\n  /**\r\n   * 判断点是否在矩形的边上，并区分是在左右边还是上下边\r\n   * @param point 坐标\r\n   * @param coor 区域坐标\r\n   * @returns 字符串，表示对应的鼠标样式，或 'none' 表示不在边上\r\n   */\r\n  isPointOnRectEdge(point: Point, coor: Point[]): string {\r\n    const [x, y] = point;\r\n    const [[x0, y0], [x1, y1]] = coor.map((a) => a.map((b) => b * this.scale));\r\n    const onLeftEdge =\r\n      x === x0 + this.originX &&\r\n      y >= y0 + this.originY &&\r\n      y <= y1 + this.originY;\r\n    const onRightEdge =\r\n      x === x1 + this.originX &&\r\n      y >= y0 + this.originY &&\r\n      y <= y1 + this.originY;\r\n    const onTopEdge =\r\n      y === y0 + this.originY &&\r\n      x >= x0 + this.originX &&\r\n      x <= x1 + this.originX;\r\n    const onBottomEdge =\r\n      y === y1 + this.originY &&\r\n      x >= x0 + this.originX &&\r\n      x <= x1 + this.originX;\r\n    if (onLeftEdge || onRightEdge) return \"ew-resize\";\r\n    if (onTopEdge || onBottomEdge) return \"ns-resize\";\r\n    return \"none\";\r\n  }\r\n\r\n  /**\r\n   * 判断点是否在矩形的顶点上，并区分是在左上、左下、右上还是右下顶点\r\n   * @param point 坐标\r\n   * @param coor 区域坐标\r\n   * @returns 字符串，表示对应的鼠标样式，或 'none' 表示不在顶点上\r\n   */\r\n  isPointOnRectVertex(point: Point, coor: Point[]): string {\r\n    const [x, y] = point;\r\n    const [[x0, y0], [x1, y1]] = coor.map((a) => a.map((b) => b * this.scale));\r\n    const onLeftTopPoint = x === x0 + this.originX && y === y0 + this.originY;\r\n    const onRightBottomEdge =\r\n      x === x1 + this.originX && y === y1 + this.originY;\r\n    const onRightTopEdge = x === x1 + this.originX && y === y0 + this.originY;\r\n    const onLeftBottomEdge = x === x0 + this.originX && y === y1 + this.originY;\r\n    if (onLeftTopPoint) return \"nw-resize\";\r\n    if (onRightBottomEdge) return \"se-resize\";\r\n    if (onRightTopEdge) return \"ne-resize\";\r\n    if (onLeftBottomEdge) return \"sw-resize\";\r\n    return \"none\";\r\n  }\r\n\r\n  /**\r\n   * 判断是否在多边形内\r\n   * @param point 坐标\r\n   * @param coor 区域坐标\r\n   * @returns 布尔值\r\n   */\r\n  isPointInPolygon(point: Point, coor: Point[]): boolean {\r\n    this.offScreenCtx.save();\r\n    this.offScreenCtx.clearRect(0, 0, this.WIDTH, this.HEIGHT);\r\n    this.offScreenCtx.translate(this.originX, this.originY);\r\n    this.offScreenCtx.beginPath();\r\n    coor.forEach((pt, i) => {\r\n      const [x, y] = pt.map((a) => Math.round(a * this.scale));\r\n      if (i === 0) {\r\n        this.offScreenCtx.moveTo(x, y);\r\n      } else {\r\n        this.offScreenCtx.lineTo(x, y);\r\n      }\r\n    });\r\n    this.offScreenCtx.closePath();\r\n    this.offScreenCtx.fill();\r\n    const areaData = this.offScreenCtx.getImageData(\r\n      0,\r\n      0,\r\n      this.WIDTH,\r\n      this.HEIGHT\r\n    );\r\n    const index = (point[1] - 1) * this.WIDTH * 4 + point[0] * 4;\r\n    this.offScreenCtx.restore();\r\n    return areaData.data[index + 3] !== 0;\r\n  }\r\n\r\n  /**\r\n   * 判断是否在多边形顶点上\r\n   * @param point 坐标\r\n   * @param coor 区域坐标\r\n   * @returns 布尔值\r\n   */\r\n  isPointOnPolygonVertex(point: Point, coor: Point[]): boolean {\r\n    // 遍历每个顶点，检查是否和目标点重合\r\n    return coor.some((pt) => {\r\n      const [x, y] = pt.map((a) => Math.round(a * this.scale));\r\n      return x === point[0] + this.originX && y === point[1] + this.originY;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * 判断是否在圆内\r\n   * @param point 坐标\r\n   * @param center 圆心\r\n   * @param r 半径\r\n   * @param needScale 是否为圆形点击检测\r\n   * @returns 布尔值\r\n   */\r\n  isPointInCircle(point: Point, center: Point, r: number): boolean {\r\n    const [x, y] = point;\r\n    const [x0, y0] = center.map((a) => a * this.scale);\r\n    const distance = Math.sqrt(\r\n      (x0 + this.originX - x) ** 2 + (y0 + this.originY - y) ** 2\r\n    );\r\n    return distance <= r;\r\n  }\r\n\r\n  /**\r\n   * 判断是否在圆的顶点上\r\n   * @param point 坐标\r\n   * @param center 圆心\r\n   * @param r 半径\r\n   * @returns 布尔值\r\n   */\r\n  isPointOnCircleVertex(point: Point, center: Point, r: number): boolean {\r\n    const [x, y] = point;\r\n    const [x0, y0] = center.map((a) => a * this.scale);\r\n    return x === x0 + this.originX + r && y === y0 + this.originY;\r\n  }\r\n\r\n  /**\r\n   * 判断是否在折线内\r\n   * @param point 坐标\r\n   * @param coor 区域坐标\r\n   * @returns 布尔值\r\n   */\r\n  isPointInLine(point: Point, coor: Point[]): boolean {\r\n    this.offScreenCtx.save();\r\n    this.offScreenCtx.clearRect(0, 0, this.WIDTH, this.HEIGHT);\r\n    this.offScreenCtx.translate(this.originX, this.originY);\r\n    this.offScreenCtx.lineWidth = this.lineWidth > 5 ? this.lineWidth : 5;\r\n    this.offScreenCtx.beginPath();\r\n    coor.forEach((pt, i) => {\r\n      const [x, y] = pt.map((a) => Math.round(a * this.scale));\r\n      if (i === 0) {\r\n        this.offScreenCtx.moveTo(x, y);\r\n      } else {\r\n        this.offScreenCtx.lineTo(x, y);\r\n      }\r\n    });\r\n    this.offScreenCtx.stroke();\r\n    const areaData = this.offScreenCtx.getImageData(\r\n      0,\r\n      0,\r\n      this.WIDTH,\r\n      this.HEIGHT\r\n    );\r\n    const index = (point[1] - 1) * this.WIDTH * 4 + point[0] * 4;\r\n    this.offScreenCtx.restore();\r\n    return areaData.data[index + 3] !== 0;\r\n  }\r\n\r\n  /**\r\n   * 判断是否在折线内\r\n   * @param mousePoint 鼠标坐标\r\n   * @param pixels 像素点索引列表\r\n   * @returns 布尔值\r\n   */\r\n  isMouseInPixelsRegion(mousePoint: Point, canvasData: ImageData): boolean {\r\n    // 调整鼠标坐标（考虑原点偏移和缩放比例）\r\n    const mouseX = Math.floor(mousePoint[0] - this.originX); // 缩放并调整鼠标的 x 坐标\r\n    const mouseY = Math.floor(mousePoint[1] - this.originY); // 缩放并调整鼠标的 y 坐标\r\n    // console.log(`Adjusted mouse coordinates: (${mouseX}, ${mouseY})`);\r\n\r\n    // 获取指定点的像素数据\r\n    // 注意canvasData的高宽是向下取整，所以this.IMAGE_WIDTH要统一向下取整\r\n    const index = (mouseY * Math.floor(this.IMAGE_WIDTH) + mouseX) * 4;\r\n    const pixelAlpha = canvasData.data[index + 3]; // 获取透明度（alpha 通道）\r\n\r\n    // 判断该点是否在 pixels 区域内\r\n    if (pixelAlpha !== 0) {\r\n      // console.log(\"Mouse is inside the pixel region.\");\r\n      return true; // 如果透明度大于 0，说明该点在像素区域内\r\n    }\r\n\r\n    // console.log(\"Mouse is outside the pixel region.\");\r\n    return false; // 否则返回 false\r\n  }\r\n\r\n  getBoundingBoxOfColoredRegion(canvasData: ImageData): Point[] {\r\n    const data = canvasData.data; // 获取图像的 RGBA 数据\r\n    const width = canvasData.width; // 图像的宽度\r\n    const height = canvasData.height; // 图像的高度\r\n\r\n    let xMin = width,\r\n      xMax = 0,\r\n      yMin = height,\r\n      yMax = 0;\r\n\r\n    // 遍历每个像素\r\n    for (let y = 0; y < height; y++) {\r\n      for (let x = 0; x < width; x++) {\r\n        // 每个像素的 RGBA 数据索引\r\n        const index = (y * width + x) * 4;\r\n\r\n        const r = data[index]; // 红色通道\r\n        const g = data[index + 1]; // 绿色通道\r\n        const b = data[index + 2]; // 蓝色通道\r\n        const a = data[index + 3]; // alpha 通道（透明度）\r\n\r\n        // 判断该像素是否有颜色（alpha不为0或RGB有非零值）\r\n        if (a !== 0 && (r !== 255 || g !== 255 || b !== 255)) {\r\n          // 更新最小和最大坐标\r\n          xMin = Math.min(xMin, x);\r\n          xMax = Math.max(xMax, x);\r\n          yMin = Math.min(yMin, y);\r\n          yMax = Math.max(yMax, y);\r\n        }\r\n      }\r\n    }\r\n\r\n    // 如果没有找到有颜色的像素，返回一个无效的矩形\r\n    if (xMin > xMax || yMin > yMax) {\r\n      return [];\r\n    }\r\n\r\n    return [\r\n      [Math.round(xMin / this.scale), Math.round(yMin / this.scale)],\r\n      [Math.round(xMax / this.scale), Math.round(yMax / this.scale)]\r\n    ];\r\n  }\r\n\r\n  // 提取图像的轮廓点\r\n  getContourPointsOfColoredRegion(\r\n    canvasData: ImageData,\r\n    densityFactor: number = 1\r\n  ): Point[] {\r\n    const data = canvasData.data; // 获取图像的 RGBA 数据\r\n    const width = canvasData.width; // 图像的宽度\r\n    const height = canvasData.height; // 图像的高度\r\n\r\n    const contourPoints: Point[] = [];\r\n\r\n    // 遍历每个像素，寻找有颜色的区域，并根据阈值决定是否为轮廓点\r\n    for (let y = 0; y < height; y++) {\r\n      for (let x = 0; x < width; x++) {\r\n        const index = (y * width + x) * 4;\r\n        const r = data[index]; // 红色通道\r\n        const g = data[index + 1]; // 绿色通道\r\n        const b = data[index + 2]; // 蓝色通道\r\n        const a = data[index + 3]; // alpha 通道（透明度）\r\n\r\n        // 判断是否为轮廓点：该点周围至少有一个邻居透明度为0的点\r\n        if (a !== 0 && (r !== 255 || g !== 255 || b !== 255)) {\r\n          const isBorderPoint = this.isBorderPoint(x, y, width, height, data);\r\n          if (isBorderPoint) {\r\n            contourPoints.push([\r\n              Math.round(x / this.scale),\r\n              Math.round(y / this.scale)\r\n            ]);\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    // 去除重复点\r\n    const uniquePoints = this.removeDuplicatePoints(\r\n      contourPoints,\r\n      false\r\n    ).resultCoor;\r\n\r\n    // 根据密度因子控制疏密程度\r\n    const sampledPoints = this.samplePointsByDensity(\r\n      uniquePoints,\r\n      densityFactor\r\n    );\r\n\r\n    // 按照顺时针方向以质心为中心排序\r\n    return this.sortByPolarAngle(sampledPoints);\r\n  }\r\n\r\n  // 判断一个点是否是轮廓点\r\n  isBorderPoint(\r\n    x: number,\r\n    y: number,\r\n    width: number,\r\n    height: number,\r\n    data: Uint8ClampedArray\r\n  ): boolean {\r\n    const directions = [\r\n      [-1, 0],\r\n      [1, 0],\r\n      [0, -1],\r\n      [0, 1], // 四个方向\r\n      [-1, -1],\r\n      [-1, 1],\r\n      [1, -1],\r\n      [1, 1] // 四个对角线方向\r\n    ];\r\n\r\n    for (const [dx, dy] of directions) {\r\n      const nx = x + dx;\r\n      const ny = y + dy;\r\n      if (nx >= 0 && nx < width && ny >= 0 && ny < height) {\r\n        const index = (ny * width + nx) * 4;\r\n        const alpha = data[index + 3]; // 获取邻点的透明度\r\n        if (alpha === 0) {\r\n          return true; // 如果邻点是透明的，那么该点为轮廓点\r\n        }\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  // 根据密度因子采样轮廓点\r\n  samplePointsByDensity(points: Point[], densityFactor: number): Point[] {\r\n    const sampledPoints: Point[] = [];\r\n    const step = Math.max(1, Math.floor(1 / densityFactor)); // 控制每隔多少个点采样一次\r\n\r\n    for (let i = 0; i < points.length; i += step) {\r\n      sampledPoints.push(points[i]);\r\n    }\r\n\r\n    return sampledPoints;\r\n  }\r\n\r\n  // 计算质心\r\n  calculateCentroid(points: Point[]): Point {\r\n    let sumX = 0;\r\n    let sumY = 0;\r\n    for (let point of points) {\r\n      sumX += point[0];\r\n      sumY += point[1];\r\n    }\r\n    const count = points.length;\r\n    return [sumX / count, sumY / count]; // 计算质心坐标\r\n  }\r\n\r\n  // 计算极角\r\n  calculatePolarAngle(center: Point, point: Point): number {\r\n    const dx = point[0] - center[0];\r\n    const dy = point[1] - center[1];\r\n    return Math.atan2(dy, dx); // 返回的值是 -PI 到 PI\r\n  }\r\n\r\n  // 按极角排序轮廓点\r\n  sortByPolarAngle(points: Point[]): Point[] {\r\n    const center = this.calculateCentroid(points); // 计算质心\r\n    return points.sort((a, b) => {\r\n      const angleA = this.calculatePolarAngle(center, a);\r\n      const angleB = this.calculatePolarAngle(center, b);\r\n      return angleA - angleB; // 从小到大排序（顺时针）\r\n    });\r\n  }\r\n\r\n  /**\r\n   * 判断是图形是否属于嵌套关系 (目前只支持矩形和多边形)\r\n   * @param shape1 标注实例\r\n   * @param shape2 标注实例\r\n   * @returns 布尔值\r\n   */\r\n  isNested(shape1: Rect | Polygon, shape2: Rect | Polygon): boolean {\r\n    return isNested(shape1, shape2);\r\n  }\r\n\r\n  /**\r\n   * 绘制矩形\r\n   * @param shape 标注实例\r\n   * @returns\r\n   */\r\n  drawRect(shape: Rect, sub?: Record<string, any>) {\r\n    if (shape.coor.length !== 2) return;\r\n    const { strokeStyle, fillStyle, active, creating, coor, lineWidth } = shape;\r\n    const [[x0, y0], [x1, y1]] = coor.map((a: Point) =>\r\n      a.map((b) => Math.round(b * this.scale))\r\n    );\r\n    this.ctx.save();\r\n    this.ctx.lineWidth = lineWidth || this.lineWidth;\r\n    this.ctx.fillStyle =\r\n      active || creating ? this.activeFillStyle : fillStyle || this.fillStyle;\r\n    this.ctx.strokeStyle =\r\n      active || creating\r\n        ? this.activeStrokeStyle\r\n        : strokeStyle || this.strokeStyle;\r\n    const w = x1 - x0;\r\n    const h = y1 - y0;\r\n    if (!creating) this.ctx.fillRect(x0, y0, w, h);\r\n    this.ctx.strokeRect(x0, y0, w, h);\r\n    this.ctx.restore();\r\n    let center = [(coor[1][0] + coor[0][0]) / 2, (coor[1][1] + coor[0][1]) / 2];\r\n    this.drawLabel(center as Point, shape);\r\n  }\r\n\r\n  /**\r\n   * 绘制多边形\r\n   * @param shape 标注实例\r\n   */\r\n  drawPolygon(shape: Polygon) {\r\n    const { strokeStyle, fillStyle, active, creating, coor, lineWidth } = shape;\r\n    this.ctx.save();\r\n    this.ctx.lineJoin = \"round\";\r\n    this.ctx.lineWidth = lineWidth || this.lineWidth;\r\n    this.ctx.fillStyle =\r\n      active || creating ? this.activeFillStyle : fillStyle || this.fillStyle;\r\n    this.ctx.strokeStyle =\r\n      active || creating\r\n        ? this.activeStrokeStyle\r\n        : strokeStyle || this.strokeStyle;\r\n    this.ctx.beginPath();\r\n    coor.forEach((el: Point, i) => {\r\n      const [x, y] = el.map((a) => Math.round(a * this.scale));\r\n      if (i === 0) {\r\n        this.ctx.moveTo(x, y);\r\n      } else {\r\n        this.ctx.lineTo(x, y);\r\n      }\r\n    });\r\n    if (creating) {\r\n      const [x, y] = this.mouse || [];\r\n      this.ctx.lineTo(x - this.originX, y - this.originY);\r\n    } else if (coor.length > 2) {\r\n      this.ctx.closePath();\r\n    }\r\n    this.ctx.fill();\r\n    this.ctx.stroke();\r\n    this.ctx.restore();\r\n    this.drawLabel(this.calculateCenter(coor), shape);\r\n  }\r\n\r\n  /**\r\n   * 绘制点\r\n   * @param shape 标注实例\r\n   */\r\n  drawDot(shape: Dot) {\r\n    if (shape.color === \"\") {\r\n      // 关键点\r\n      const { strokeStyle, fillStyle, active, coor, lineWidth } = shape;\r\n      const [x, y] = coor.map((a) => a * this.scale);\r\n      this.ctx.save();\r\n      this.ctx.lineWidth = lineWidth || this.lineWidth;\r\n      this.ctx.fillStyle = active\r\n        ? this.activeFillStyle\r\n        : fillStyle || this.ctrlFillStyle;\r\n      this.ctx.strokeStyle = active\r\n        ? this.activeStrokeStyle\r\n        : strokeStyle || this.strokeStyle;\r\n      this.ctx.beginPath();\r\n      this.ctx.arc(x, y, this.ctrlRadius, 0, 2 * Math.PI, true);\r\n      this.ctx.fill();\r\n      this.ctx.arc(x, y, this.ctrlRadius, 0, 2 * Math.PI, true);\r\n      this.ctx.stroke();\r\n      this.ctx.restore();\r\n      this.drawLabel(coor as Point, shape);\r\n    } else {\r\n      // 智能标注点（SAM）\r\n      const { color, coor } = shape;\r\n      const [x, y] = coor.map((a) => a * this.scale);\r\n      this.ctx.beginPath();\r\n      this.ctx.arc(x, y, 3, 0, Math.PI * 2);\r\n      this.ctx.fillStyle = `rgba(255, 255, 255, 0.75)`;\r\n      this.ctx.fill();\r\n      this.ctx.strokeStyle = color;\r\n      this.ctx.stroke();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 绘制圆\r\n   * @param shape 标注实例\r\n   */\r\n  drawCirle(shape: Circle) {\r\n    const {\r\n      strokeStyle,\r\n      fillStyle,\r\n      active,\r\n      coor,\r\n      label,\r\n      creating,\r\n      radius,\r\n      ctrlsData,\r\n      lineWidth\r\n    } = shape;\r\n    const [x, y] = coor.map((a) => a * this.scale);\r\n    this.ctx.save();\r\n    this.ctx.lineWidth = lineWidth || this.lineWidth;\r\n    this.ctx.fillStyle =\r\n      active || creating ? this.activeFillStyle : fillStyle || this.fillStyle;\r\n    this.ctx.strokeStyle =\r\n      active || creating\r\n        ? this.activeStrokeStyle\r\n        : strokeStyle || this.strokeStyle;\r\n    this.ctx.beginPath();\r\n    this.ctx.arc(x, y, radius * this.scale, 0, 2 * Math.PI, true);\r\n    this.ctx.fill();\r\n    this.ctx.arc(x, y, radius * this.scale, 0, 2 * Math.PI, true);\r\n    this.ctx.stroke();\r\n    this.ctx.restore();\r\n    this.drawLabel(shape.coor as Point, shape);\r\n  }\r\n\r\n  /**\r\n   * 绘制折线\r\n   * @param shape 标注实例\r\n   */\r\n  drawLine(shape: Line) {\r\n    const { strokeStyle, active, creating, coor, lineWidth } = shape;\r\n    this.ctx.save();\r\n    this.ctx.lineJoin = \"round\";\r\n    this.ctx.lineWidth = lineWidth || this.lineWidth;\r\n    this.ctx.strokeStyle =\r\n      active || creating\r\n        ? this.activeStrokeStyle\r\n        : strokeStyle || this.strokeStyle;\r\n    this.ctx.beginPath();\r\n    coor.forEach((el: Point, i) => {\r\n      const [x, y] = el.map((a) => Math.round(a * this.scale));\r\n      if (i === 0) {\r\n        this.ctx.moveTo(x, y);\r\n      } else {\r\n        this.ctx.lineTo(x, y);\r\n      }\r\n    });\r\n    if (creating) {\r\n      const [x, y] = this.mouse || [];\r\n      this.ctx.lineTo(x - this.originX, y - this.originY);\r\n    }\r\n    this.ctx.stroke();\r\n    this.ctx.restore();\r\n    this.drawLabel(coor[0], shape);\r\n  }\r\n\r\n  hexToRGBA(hex: string, alpha = 0.7) {\r\n    // 去掉 # 号\r\n    let hexCode = hex.replace(/^#/, \"\");\r\n\r\n    // 检查输入的 hex 是否是有效的三位或六位颜色代码\r\n    if (\r\n      !/^[A-Fa-f0-9]{3}$/.test(hexCode) &&\r\n      !/^[A-Fa-f0-9]{6}$/.test(hexCode)\r\n    ) {\r\n      return hex;\r\n    }\r\n\r\n    // 如果是三位颜色代码，扩展为六位\r\n    if (hexCode.length === 3) {\r\n      hexCode = hexCode\r\n        .split(\"\")\r\n        .map((char) => char + char)\r\n        .join(\"\");\r\n    }\r\n\r\n    // 将颜色代码拆分为 R, G, B 组件\r\n    const r = parseInt(hexCode.slice(0, 2), 16); // 提取红色部分\r\n    const g = parseInt(hexCode.slice(2, 4), 16); // 提取绿色部分\r\n    const b = parseInt(hexCode.slice(4, 6), 16); // 提取蓝色部分\r\n\r\n    // 返回带有透明度的 RGBA 格式颜色\r\n    return `rgba(${r}, ${g}, ${b}, ${alpha})`;\r\n  }\r\n\r\n  rgbaToHex(rgba: string, includeAlpha: boolean = false): string {\r\n    // 去掉 rgba 前后的空格和括号\r\n    rgba = rgba.trim().replace(/\\s/g, \"\");\r\n    const rgbaArray = rgba.match(\r\n      /(\\d{1,3}),(\\d{1,3}),(\\d{1,3}),?(\\d+(\\.\\d+)?)?/\r\n    );\r\n\r\n    if (!rgbaArray) {\r\n      return rgba; // 如果输入不是有效的 rgba 格式，返回原字符串\r\n    }\r\n\r\n    const r = parseInt(rgbaArray[1], 10);\r\n    const g = parseInt(rgbaArray[2], 10);\r\n    const b = parseInt(rgbaArray[3], 10);\r\n    const a = rgbaArray[4] ? parseFloat(rgbaArray[4]) : 1.0;\r\n\r\n    // 将 R, G, B 转换为两位的十六进制字符串\r\n    const hexR = r.toString(16).padStart(2, \"0\");\r\n    const hexG = g.toString(16).padStart(2, \"0\");\r\n    const hexB = b.toString(16).padStart(2, \"0\");\r\n\r\n    if (includeAlpha) {\r\n      // 将透明度转换为两位的十六进制字符串\r\n      const hexA = Math.round(a * 255)\r\n        .toString(16)\r\n        .padStart(2, \"0\");\r\n      return `#${hexR}${hexG}${hexB}${hexA}`;\r\n    } else {\r\n      return `#${hexR}${hexG}${hexB}`;\r\n    }\r\n  }\r\n\r\n  isRGBA(color: string): boolean {\r\n    const rgbaRegex =\r\n      /^rgba\\((\\d{1,3}),\\s*(\\d{1,3}),\\s*(\\d{1,3}),\\s*(0(\\.\\d+)?|1(\\.0+)?)\\)$/;\r\n    return rgbaRegex.test(color);\r\n  }\r\n\r\n  removeDuplicatePoints(\r\n    points: [number, number][],\r\n    getBunding: boolean = false,\r\n    removePoints: boolean = true\r\n  ) {\r\n    const seen = new Set();\r\n    const uniquePoints: [number, number][] = [];\r\n    let maxX = points[0][0],\r\n      minX = points[0][0],\r\n      maxY = points[0][1],\r\n      minY = points[0][1];\r\n\r\n    if (!removePoints) {\r\n      if (getBunding) {\r\n        points.forEach((point) => {\r\n          // 计算最大最小值\r\n          if (point[0] !== -1 && point[1] !== -1) {\r\n            maxX = Math.max(maxX, point[0]);\r\n            maxY = Math.max(maxY, point[1]);\r\n            minX = Math.min(minX, point[0]);\r\n            minY = Math.min(minY, point[1]);\r\n          }\r\n        });\r\n        if (this.activeShape.type === Shape.Brush) {\r\n          return {\r\n            resultRect: [\r\n              minX - this.brushlineWidth / 2,\r\n              minY - this.brushlineWidth / 2,\r\n              maxX - minX + this.brushlineWidth,\r\n              maxY - minY + this.brushlineWidth\r\n            ]\r\n          };\r\n        } else {\r\n          return {\r\n            resultRect: [minX, minY, maxX - minX, maxY - minY]\r\n          };\r\n        }\r\n      }\r\n    } else {\r\n      if (getBunding) {\r\n        points.forEach((point) => {\r\n          // 坐标点去重\r\n          const key = `${point[0]},${point[1]}`;\r\n          if (!seen.has(key)) {\r\n            seen.add(key);\r\n            uniquePoints.push(point);\r\n          }\r\n          // 计算最大最小值\r\n          if (getBunding && point[0] !== -1 && point[1] !== -1) {\r\n            maxX = Math.max(maxX, point[0]);\r\n            maxY = Math.max(maxY, point[1]);\r\n            minX = Math.min(minX, point[0]);\r\n            minY = Math.min(minY, point[1]);\r\n          }\r\n        });\r\n        if (this.activeShape.type === Shape.Brush) {\r\n          return {\r\n            resultCoor: uniquePoints,\r\n            resultRect: [\r\n              minX - this.brushlineWidth / 2,\r\n              minY - this.brushlineWidth / 2,\r\n              maxX - minX + this.brushlineWidth,\r\n              maxY - minY + this.brushlineWidth\r\n            ]\r\n          };\r\n        } else {\r\n          return {\r\n            resultCoor: uniquePoints,\r\n            resultRect: [minX, minY, maxX - minX, maxY - minY]\r\n          };\r\n        }\r\n      } else {\r\n        points.forEach((point) => {\r\n          // 坐标点去重\r\n          const key = `${point[0]},${point[1]}`;\r\n          if (!seen.has(key)) {\r\n            seen.add(key);\r\n            uniquePoints.push(point);\r\n          }\r\n        });\r\n        return { resultCoor: uniquePoints };\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 绘制轨迹\r\n   * @param shape 轨迹实例\r\n   */\r\n  drawBrush(shape: Brush) {\r\n    const {\r\n      strokeStyle,\r\n      active,\r\n      creating,\r\n      coor,\r\n      lineWidth,\r\n      iseraser,\r\n      boundingRect\r\n    } = shape;\r\n    this.ctx.save();\r\n    this.ctx.lineJoin = \"round\";\r\n    this.ctx.lineCap = \"round\";\r\n    this.ctx.lineWidth = lineWidth || this.brushlineWidth;\r\n\r\n    // 应用缩放\r\n    this.ctx.scale(this.scale, this.scale);\r\n\r\n    if (coor.length > 1) {\r\n      // 至少两个点才能绘制路径\r\n      if (iseraser) {\r\n        // 设置颜色，包含透明度\r\n        this.ctx.strokeStyle = \"rgba(255, 0, 0, 1)\";\r\n        this.ctx.fillStyle = \"rgba(255, 0, 0, 1)\";\r\n        this.ctx.globalCompositeOperation = \"destination-out\"; // 橡皮擦效果\r\n      } else {\r\n        const color =\r\n          active || creating\r\n            ? this.activeStrokeStyle\r\n            : strokeStyle || this.brushstrokeStyle;\r\n        this.ctx.strokeStyle = color;\r\n        this.ctx.fillStyle = color;\r\n        this.ctx.globalCompositeOperation = \"source-over\";\r\n      }\r\n\r\n      this.ctx.beginPath();\r\n      this.ctx.moveTo(coor[0][0], coor[0][1]); // 从第一个点开始\r\n\r\n      for (let i = 1; i < coor.length; i++) {\r\n        this.ctx.lineTo(coor[i][0], coor[i][1]); // 绘制到下一个点\r\n      }\r\n\r\n      this.ctx.stroke();\r\n\r\n      // if (active && this.activeShape.boundingRect.length > 0) {\r\n      //   const [x, y, w, h] = this.activeShape.boundingRect;\r\n      //   this.ctx.lineWidth = 1;\r\n      //   this.ctx.strokeStyle = this.activeStrokeStyle;\r\n      //   this.ctx.beginPath();\r\n      //   this.ctx.strokeRect(x, y, w, h);\r\n      //   this.ctx.stroke();\r\n      // }\r\n    }\r\n    this.ctx.restore();\r\n  }\r\n\r\n  /**\r\n   * 绘制网格\r\n   * @param shape 标注实例\r\n   * @returns\r\n   */\r\n  drawGrid(shape: Grid) {\r\n    if (shape.coor.length !== 2) return;\r\n    const { strokeStyle, fillStyle, active, creating, coor, lineWidth } = shape;\r\n    const [[x0, y0], [x1, y1]] = coor.map((a: Point) =>\r\n      a.map((b) => Math.round(b * this.scale))\r\n    );\r\n    this.ctx.save();\r\n    this.ctx.lineWidth = lineWidth || this.lineWidth;\r\n    this.ctx.fillStyle =\r\n      active || creating ? this.activeFillStyle : fillStyle || this.fillStyle;\r\n    this.ctx.strokeStyle =\r\n      active || creating\r\n        ? this.activeStrokeStyle\r\n        : strokeStyle || this.strokeStyle;\r\n    shape.gridRects.forEach((rect: Rect, m) => {\r\n      this.drawRect(rect, {\r\n        selectedFillStyle:\r\n          shape.selectedFillStyle || this.gridSelectedFillStyle,\r\n        isSelected: shape.selected?.includes(m)\r\n      });\r\n    });\r\n    const w = x1 - x0;\r\n    const h = y1 - y0;\r\n    if (!creating) this.ctx.fillRect(x0, y0, w, h);\r\n    this.ctx.strokeRect(x0, y0, w, h);\r\n    this.ctx.restore();\r\n    this.drawLabel(coor[0], shape);\r\n  }\r\n\r\n  /**\r\n   * 绘制控制点\r\n   * @param point 坐标\r\n   */\r\n  drawCtrl(point: Point) {\r\n    const [x, y] = point.map((a) => a * this.scale);\r\n    this.ctx.save();\r\n    this.ctx.beginPath();\r\n    this.ctx.fillStyle = this.ctrlFillStyle;\r\n    this.ctx.strokeStyle = this.ctrlStrokeStyle;\r\n    this.ctx.arc(x, y, this.ctrlRadius, 0, 2 * Math.PI, true);\r\n    this.ctx.fill();\r\n    this.ctx.arc(x, y, this.ctrlRadius, 0, 2 * Math.PI, true);\r\n    this.ctx.stroke();\r\n    this.ctx.restore();\r\n  }\r\n\r\n  /**\r\n   * 绘制控制点列表\r\n   * @param shape 标注实例\r\n   */\r\n  drawCtrlList(shape: Rect | Polygon | Line) {\r\n    shape.ctrlsData.forEach((point, i) => {\r\n      if (\r\n        (shape.type === Shape.Polygon || shape.type === Shape.Line) &&\r\n        (i === this.ctrlIndex || i === this.clickIndex)\r\n      ) {\r\n        this.ctrlStrokeStyle = \"red\";\r\n        this.ctrlRadius = 5;\r\n      } else {\r\n        this.ctrlStrokeStyle = \"#000\";\r\n        this.ctrlRadius = 3;\r\n      }\r\n      if (shape.type === Shape.Circle) {\r\n        if (i === 1) this.drawCtrl(point);\r\n      } else {\r\n        this.drawCtrl(point);\r\n      }\r\n    });\r\n  }\r\n\r\n  // 计算多个坐标的中心位置\r\n  calculateCenter(points: [number, number][]): [number, number] {\r\n    if (points.length === 0) {\r\n      throw new Error(\"Points array cannot be empty.\");\r\n    }\r\n\r\n    const sum = points.reduce(\r\n      (acc, [x, y]) => {\r\n        acc[0] += x; // 累加 x 坐标\r\n        acc[1] += y; // 累加 y 坐标\r\n        return acc;\r\n      },\r\n      [0, 0]\r\n    );\r\n\r\n    const centerX = sum[0] / points.length; // 计算平均 x 坐标\r\n    const centerY = sum[1] / points.length; // 计算平均 y 坐标\r\n\r\n    return [centerX, centerY] as Point; // 返回中心坐标\r\n  }\r\n\r\n  getImagedataFromImageClass = (\r\n    image: HTMLImageElement,\r\n    masktype: string\r\n  ): Uint8ClampedArray | null => {\r\n    // 创建一个临时的 canvas 元素用于处理图像\r\n    const maskCanvas = document.createElement(\"canvas\");\r\n    const maskContext = maskCanvas.getContext(\"2d\", {\r\n      willReadFrequently: true\r\n    });\r\n\r\n    if (!maskCanvas || !maskContext) {\r\n      console.error(\"Canvas or context is not initialized\");\r\n      return null;\r\n    }\r\n\r\n    maskCanvas.width = this.WIDTH;\r\n    maskCanvas.height = this.HEIGHT;\r\n\r\n    // 将图像绘制到临时 canvas 上\r\n    const tmpCanvas = document.createElement(\"canvas\");\r\n    const tmpContext = tmpCanvas.getContext(\"2d\", { willReadFrequently: true });\r\n\r\n    if (!tmpContext) {\r\n      console.error(\"Temporary canvas context is not initialized\");\r\n      return null;\r\n    }\r\n\r\n    tmpCanvas.width = this.WIDTH;\r\n    tmpCanvas.height = this.HEIGHT;\r\n    tmpContext.drawImage(image, 0, 0);\r\n\r\n    let imageData = tmpContext?.getImageData(\r\n      0,\r\n      0,\r\n      tmpCanvas.width,\r\n      tmpCanvas.height\r\n    );\r\n    let pixelData = imageData?.data;\r\n\r\n    if (!pixelData) {\r\n      console.error(\"Failed to retrieve pixel data\");\r\n      return null;\r\n    }\r\n\r\n    // 获取 maskCanvas 的图像数据\r\n    const imageMask = maskContext.getImageData(0, 0, this.WIDTH, this.HEIGHT);\r\n    const maskData = imageMask.data;\r\n\r\n    // 根据 masktype 处理图像数据\r\n    if (masktype === \"everything\") {\r\n      for (let i = 0; i < pixelData.length; i += 4) {\r\n        if (pixelData[i] > 0) {\r\n          const colorIndex = pixelData[i] % this.random_color.length;\r\n          maskData[i] = this.random_color[colorIndex].r; // red\r\n          maskData[i + 1] = this.random_color[colorIndex].g; // green\r\n          maskData[i + 2] = this.random_color[colorIndex].b; // blue\r\n          maskData[i + 3] = this.mask_alpha; // alpha\r\n        }\r\n      }\r\n      maskContext.putImageData(imageMask, 0, 0);\r\n    } else if (masktype === \"rect\") {\r\n    } else if (masktype === \"magic\") {\r\n      let pixels = [];\r\n      // Get the pixel indices of the mask\r\n      for (let i = 0; i < pixelData.length; i += 4) {\r\n        if (\r\n          pixelData[i] == 255 &&\r\n          pixelData[i + 1] == 255 &&\r\n          pixelData[i + 2] == 255\r\n        ) {\r\n          pixels.push(i);\r\n        }\r\n      }\r\n    } else {\r\n      console.error(\"Unknown mask type\");\r\n      return null;\r\n    }\r\n\r\n    // 创建一个新的 canvas 元素并绘制缩放后的图像\r\n    const scaledCanvas = document.createElement(\"canvas\");\r\n    const scaledContext = scaledCanvas.getContext(\"2d\", {\r\n      willReadFrequently: true\r\n    });\r\n\r\n    if (!scaledContext) {\r\n      console.error(\"Scaled canvas context is not initialized\");\r\n      return null;\r\n    }\r\n\r\n    scaledCanvas.width = this.IMAGE_WIDTH;\r\n    scaledCanvas.height = this.IMAGE_HEIGHT;\r\n    scaledContext.drawImage(image, 0, 0, this.IMAGE_WIDTH, this.IMAGE_HEIGHT);\r\n\r\n    // 获取缩放后的图像数据\r\n    const scaledImageData = scaledContext.getImageData(\r\n      0,\r\n      0,\r\n      this.IMAGE_WIDTH,\r\n      this.IMAGE_HEIGHT\r\n    );\r\n    return scaledImageData.data;\r\n  };\r\n\r\n  putDataOnCanvas(\r\n    thisCanvas: HTMLCanvasElement,\r\n    pixels: number[],\r\n    fillStyle: string,\r\n    putImageData: boolean = true\r\n  ) {\r\n    const thisContext = thisCanvas.getContext(\"2d\", {\r\n      willReadFrequently: true\r\n    });\r\n    if (!thisContext) {\r\n      return;\r\n    }\r\n    const canvasData = thisContext.getImageData(\r\n      this.originX,\r\n      this.originY,\r\n      this.IMAGE_WIDTH,\r\n      this.IMAGE_HEIGHT\r\n    );\r\n    const data = canvasData.data;\r\n    const rgbaRegex = /rgba?\\((\\d+), (\\d+), (\\d+)(?:, ([0-9.]+))?\\)/;\r\n    const replacementColor = fillStyle.match(rgbaRegex);\r\n\r\n    for (let i = 0; i < pixels.length; i += 1) {\r\n      data[pixels[i]] = parseInt(replacementColor[1], 10); // red\r\n      data[pixels[i] + 1] = parseInt(replacementColor[2], 10); // green\r\n      data[pixels[i] + 2] = parseInt(replacementColor[3], 10); // blue\r\n      data[pixels[i] + 3] =\r\n        (replacementColor[4] !== undefined\r\n          ? parseFloat(replacementColor[4])\r\n          : 0.5) * 255; // alpha\r\n    }\r\n    if (putImageData) {\r\n      thisContext.putImageData(canvasData, this.originX, this.originY);\r\n    }\r\n    return canvasData;\r\n  }\r\n\r\n  drawPromptPointOnClick = (\r\n    thisPrompt: MagicPoint,\r\n    canvas: HTMLCanvasElement\r\n  ): void => {\r\n    const x = thisPrompt.coor[0] * this.scale;\r\n    const y = thisPrompt.coor[1] * this.scale;\r\n\r\n    const fillColor = `rgba(255, 255, 255, 0.75)`;\r\n    const strokeColor = thisPrompt.color;\r\n\r\n    const context = canvas.getContext(\"2d\", { willReadFrequently: true });\r\n    if (!context) return;\r\n\r\n    context.beginPath();\r\n    context.arc(x, y, 3, 0, Math.PI * 2);\r\n    context.fillStyle = fillColor;\r\n    context.fill();\r\n    context.strokeStyle = strokeColor;\r\n    context.stroke();\r\n  };\r\n\r\n  /**\r\n   * 高亮Mask\r\n   * @param index Mask的索引\r\n   * @param highlight 是否高亮\r\n   * @returns\r\n   */\r\n  highlightMask(index: number) {\r\n    let activeColor = \"\";\r\n    if (index > -1) {\r\n      const shape = this.dataset[index];\r\n      activeColor = shape.fillStyle.replace(\r\n        /rgba\\((\\d+), (\\d+), (\\d+), (\\d+(\\.\\d+)?)\\)/,\r\n        (match, r, g, b, a) => {\r\n          return `rgba(${r}, ${g}, ${b}, 0.75)`;\r\n        }\r\n      );\r\n      shape.fillStyle = activeColor;\r\n      // this.update();\r\n    } else {\r\n      // let state = false;\r\n      for (let i = 0; i < this.dataset.length; i++) {\r\n        if (this.dataset[i].type === Shape.Mask) {\r\n          activeColor = this.dataset[i].fillStyle.replace(\r\n            /rgba\\((\\d+), (\\d+), (\\d+), (\\d+(\\.\\d+)?)\\)/,\r\n            (match, r, g, b, a) => {\r\n              return `rgba(${r}, ${g}, ${b}, 0.5)`;\r\n            }\r\n          );\r\n          this.dataset[i].fillStyle = activeColor;\r\n          // state = true;\r\n        }\r\n      }\r\n      // if(state){\r\n      //     this.update();\r\n      // }\r\n    }\r\n    this.update(); // 此处，一方面用于更新Mask高亮；另一方面用于更新控制点加粗变红\r\n  }\r\n\r\n  changeMaskPolygon(densityFactor: number) {\r\n    const polygonShape = this.dataset.find(\r\n      (item) => item.uuid === this.activePolygon\r\n    );\r\n    polygonShape.coor = this.getContourPointsOfColoredRegion(\r\n      this.activeCanvasData,\r\n      densityFactor\r\n    );\r\n    this.update();\r\n  }\r\n\r\n  endMagicTool() {\r\n    this.manageDoneList(deepClone(this.dataset));\r\n  }\r\n\r\n  /**\r\n   * 绘制Mask\r\n   * @param shape 标注实例\r\n   * @returns\r\n   */\r\n  drawMask(shape: Mask) {\r\n    if (\r\n      shape.pixels.length !== 0 &&\r\n      shape.height === this.IMAGE_HEIGHT &&\r\n      shape.weight === this.IMAGE_WIDTH\r\n    ) {\r\n      this.putDataOnCanvas(this.canvas, shape.pixels, shape.fillStyle);\r\n      // console.log(shape.pixels);\r\n      return;\r\n    }\r\n    const maskBase64 = shape.maskBase64;\r\n    // 将 base64 转换为图像\r\n    const maskImage = new Image();\r\n    maskImage.crossOrigin = \"Anonymous\";\r\n    maskImage.src = `data:image/png;base64,${maskBase64}`;\r\n\r\n    const self = this;\r\n\r\n    // 处理图像数据\r\n    maskImage.onload = () => {\r\n      if (shape.maskType === \"everything\") {\r\n        const pixelData = self.getImagedataFromImageClass(\r\n          maskImage,\r\n          \"everything\"\r\n        );\r\n\r\n        if (pixelData) {\r\n          const canvasData = self.ctx.getImageData(\r\n            self.originX,\r\n            self.originY,\r\n            self.IMAGE_WIDTH,\r\n            self.IMAGE_HEIGHT\r\n          );\r\n          const data = canvasData.data;\r\n\r\n          // 遍历图像像素并修改对应的颜色\r\n          for (let i = 0; i < pixelData.length; i += 4) {\r\n            if (pixelData[i] > 0) {\r\n              const color =\r\n                self.random_color[pixelData[i] % self.random_color.length];\r\n              data[i] = color.r; // red\r\n              data[i + 1] = color.g; // green\r\n              data[i + 2] = color.b; // blue\r\n              data[i + 3] = this.mask_alpha; // alpha\r\n            }\r\n          }\r\n\r\n          // 更新 canvas 上的图像数据\r\n          self.ctx.putImageData(canvasData, self.originX, self.originY);\r\n        }\r\n      } else if (shape.maskType === \"click\") {\r\n        const pixels: number[] = []; // 保存所有符合条件的像素的索引位置\r\n        const pixelData = self.getImagedataFromImageClass(maskImage, \"magic\");\r\n\r\n        if (pixelData) {\r\n          for (let i = 0; i < pixelData.length; i += 4) {\r\n            if (\r\n              pixelData[i] === 255 &&\r\n              pixelData[i + 1] === 255 &&\r\n              pixelData[i + 2] === 255\r\n            ) {\r\n              pixels.push(i);\r\n            }\r\n          }\r\n\r\n          shape.pixels = pixels;\r\n          shape.height = self.IMAGE_HEIGHT;\r\n          shape.weight = self.IMAGE_WIDTH;\r\n          shape.fillStyle = shape.strokeStyle;\r\n\r\n          shape.canvasData = self.putDataOnCanvas(\r\n            self.canvas,\r\n            pixels,\r\n            shape.fillStyle\r\n          );\r\n        } else {\r\n          console.error(\"Failed to get pixel data from mask image\");\r\n        }\r\n      } else {\r\n      }\r\n    };\r\n  }\r\n\r\n  addPoint() {\r\n    const shape = this.activeShape;\r\n    if (\r\n      Object.keys(shape).length !== 0 &&\r\n      this.clickIndex > -1 &&\r\n      !this.readonly\r\n    ) {\r\n      const [x, y] = this.activeShape.coor[this.clickIndex];\r\n      const nx = Math.round(x + 3);\r\n      const ny = Math.round(y + 3);\r\n      shape.coor.splice(this.clickIndex + 1, 0, [nx, ny]);\r\n      this.clickIndex++;\r\n      this.update();\r\n      this.manageDoneList(deepClone(this.dataset));\r\n    }\r\n  }\r\n\r\n  deletePoint() {\r\n    const shape = this.activeShape;\r\n    if (\r\n      Object.keys(shape).length !== 0 &&\r\n      shape.coor.length > 3 &&\r\n      this.clickIndex > -1 &&\r\n      !this.readonly\r\n    ) {\r\n      shape.coor.splice(this.clickIndex, 1);\r\n      this.update();\r\n      this.manageDoneList(deepClone(this.dataset));\r\n      this.clickIndex = -1;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 绘制路径线段\r\n   * @param shape 标注实例\r\n   * @returns\r\n   */\r\n  drawPencil(shape: Pencil) {\r\n    const { strokeStyle, fillStyle, active, creating, coor, lineWidth } = shape;\r\n\r\n    // 保存上下文状态\r\n    this.ctx.save();\r\n\r\n    // 设置绘制样式\r\n    this.ctx.lineJoin = \"round\"; // 线条连接处圆角处理\r\n    this.ctx.lineCap = \"round\"; // 线条端点圆角处理\r\n    this.ctx.lineWidth = lineWidth || this.pencillineWidth; // 设置线条宽度\r\n\r\n    // 设置颜色，包含透明度\r\n    this.ctx.strokeStyle =\r\n      active || creating\r\n        ? this.activeStrokeStyle\r\n        : strokeStyle || this.pencilstrokeStyle;\r\n    this.ctx.fillStyle =\r\n      active || creating\r\n        ? this.activeFillStyle\r\n        : fillStyle || this.pencilstrokeStyle;\r\n\r\n    // 应用缩放\r\n    this.ctx.scale(this.scale, this.scale);\r\n\r\n    // 如果有足够的点进行绘制\r\n    if (coor.length > 1) {\r\n      // 检查是否有结束标志点 (-1, -1)\r\n      const hasEndPoint = coor.some(\r\n        (point) => point[0] === -1 && point[1] === -1\r\n      );\r\n\r\n      // 过滤掉结束标志点\r\n      const validCoor = coor.filter(\r\n        (point) => !(point[0] === -1 && point[1] === -1)\r\n      );\r\n\r\n      if (validCoor.length > 1) {\r\n        // 设置全局组合操作\r\n        this.ctx.globalCompositeOperation = \"source-over\"; // 默认绘制模式\r\n\r\n        // 开始路径\r\n        this.ctx.beginPath();\r\n        this.ctx.moveTo(validCoor[0][0], validCoor[0][1]); // 从第一个点开始\r\n\r\n        // 遍历有效坐标绘制线段\r\n        for (let i = 1; i < validCoor.length; i++) {\r\n          this.ctx.lineTo(validCoor[i][0], validCoor[i][1]); // 绘制到下一个点\r\n        }\r\n\r\n        // 如果有结束标志点，则首尾相连\r\n        if (hasEndPoint) {\r\n          this.ctx.closePath(); // 首尾相连\r\n        }\r\n      }\r\n\r\n      // if (active && this.activeShape.boundingRect.length > 0) {\r\n      //   const [x, y, w, h] = this.activeShape.boundingRect;\r\n      //   this.ctx.lineWidth = 1;\r\n      //   this.ctx.strokeStyle = this.activeStrokeStyle;\r\n      //   this.ctx.strokeRect(x, y, w, h);\r\n      // }\r\n\r\n      // 绘制路径\r\n      this.ctx.stroke();\r\n\r\n      // 如果路径闭合，填充封闭区域\r\n      if (hasEndPoint) {\r\n        this.ctx.clip(); // 限制填充区域到路径范围\r\n        this.ctx.fill();\r\n      }\r\n    }\r\n    // 恢复上下文状态\r\n    this.ctx.restore();\r\n  }\r\n\r\n  /**\r\n   * 绘制label\r\n   * @param point 位置\r\n   * @param label 文本\r\n   */\r\n  drawLabel(point: Point, shape: AllShape) {\r\n    const {\r\n      label = \"\",\r\n      labelFillStyle = \"\",\r\n      labelFontFamily = \"\",\r\n      textFillStyle = \"\",\r\n      hideLabel,\r\n      labelUp,\r\n      lineWidth,\r\n      coor\r\n    } = shape;\r\n\r\n    if (\r\n      !label.length ||\r\n      (typeof hideLabel === \"boolean\" ? hideLabel : this.hideLabel)\r\n    )\r\n      return;\r\n\r\n    const textPadding = { left: 4, top: 4 };\r\n    const newText =\r\n      label.length <= this.labelMaxLen\r\n        ? label\r\n        : `${label.slice(0, this.labelMaxLen)}...`;\r\n\r\n    // 设置字体缩放比例\r\n    const scaleFactor =\r\n      (this.textscaleStep >= 0 ? 1.1 : 0.9) ** Math.abs(this.textscaleStep);\r\n    this.ctx.font = `${this.labelFontSize * scaleFactor}px ${\r\n      labelFontFamily || \"sans-serif\"\r\n    }`;\r\n\r\n    const textMetrics = this.ctx.measureText(newText);\r\n    const labelWidth = textMetrics.width + textPadding.left * 2;\r\n    const labelHeight = parseInt(this.ctx.font) - 4 + textPadding.top * 2;\r\n\r\n    const currLineWidth = lineWidth || this.lineWidth;\r\n    const isLabelUp = typeof labelUp === \"boolean\" ? labelUp : this.labelUp;\r\n\r\n    const toLeft = this.IMAGE_ORIGIN_WIDTH - point[0] < labelWidth / this.scale;\r\n    const toTop =\r\n      this.IMAGE_ORIGIN_HEIGHT - point[1] < labelHeight / this.scale;\r\n    const toTop2 = point[1] > labelHeight / this.scale;\r\n    const isUp = isLabelUp ? toTop2 : toTop;\r\n\r\n    this.ctx.save();\r\n    this.ctx.fillStyle = labelFillStyle || this.labelFillStyle;\r\n\r\n    let [x, y] = point.map((a) => a * this.scale);\r\n\r\n    // 以 point 为中心创建 label\r\n    if ([1, 2, 5].includes(shape.type)) {\r\n      x -= labelWidth / 2;\r\n      y -= labelHeight / 2;\r\n    }\r\n\r\n    // 计算矩形位置\r\n    const rectX = toLeft\r\n      ? x - textMetrics.width - textPadding.left + currLineWidth / 2\r\n      : x + currLineWidth / 2;\r\n    const rectY = isUp\r\n      ? y - labelHeight - currLineWidth / 2\r\n      : y + currLineWidth / 2;\r\n\r\n    // 计算缩放后的矩形大小\r\n    const rectWidth = labelWidth;\r\n    const rectHeight = labelHeight;\r\n    this.ctx.fillRect(rectX, rectY, rectWidth, rectHeight);\r\n\r\n    // 设置文本样式\r\n    this.ctx.fillStyle = textFillStyle || this.textFillStyle;\r\n    this.ctx.textBaseline = \"middle\";\r\n\r\n    // 计算文本绘制位置\r\n    const textX = rectX + (rectWidth - textMetrics.width) / 2;\r\n    const textY = rectY + rectHeight / 2;\r\n\r\n    // 绘制文本\r\n    this.ctx.fillText(newText, textX, textY, rectWidth);\r\n    this.ctx.restore();\r\n  }\r\n\r\n  /**\r\n   * 更新画布\r\n   */\r\n  update(toMask: boolean = false, initSize: boolean = false) {\r\n    window.cancelAnimationFrame(this.timer);\r\n    if (initSize) {\r\n      this.initZoom();\r\n    }\r\n    this.timer = window.requestAnimationFrame(() => {\r\n      this.ctx.save();\r\n      this.ctx.clearRect(0, 0, this.WIDTH, this.HEIGHT);\r\n      this.ctx.translate(this.originX, this.originY); // 位置映射，（0,0）对应着（this.originX, this.originY）\r\n      if (this.IMAGE_WIDTH && this.IMAGE_HEIGHT) {\r\n        if (toMask) {\r\n          // 获取图像的像素数据\r\n          const imageData = this.ctx.getImageData(\r\n            0,\r\n            0,\r\n            this.IMAGE_WIDTH,\r\n            this.IMAGE_HEIGHT\r\n          );\r\n          const data = imageData.data;\r\n\r\n          // 将所有像素的 RGB 值设置为 0 (黑色)\r\n          for (let i = 0; i < data.length; i += 4) {\r\n            data[i] = 0; // Red\r\n            data[i + 1] = 0; // Green\r\n            data[i + 2] = 0; // Blue\r\n            data[i + 3] = 255; // alpha\r\n          }\r\n\r\n          // 将修改后的像素数据重新放回画布\r\n          this.ctx.putImageData(imageData, this.originX, this.originY);\r\n        } else {\r\n          // console.log(\"this.imagesrc\", this.image.src);\r\n          // console.log(\"this.image1\", this.image);\r\n          if (!this.image.src.includes(\"undefined\")) {\r\n            if (this.imagealpha === 1) {\r\n              this.ctx.drawImage(\r\n                this.image,\r\n                0,\r\n                0,\r\n                this.IMAGE_WIDTH,\r\n                this.IMAGE_HEIGHT\r\n              );\r\n            } else {\r\n              this.ctx.globalAlpha = this.imagealpha;\r\n              this.ctx.drawImage(\r\n                this.image,\r\n                0,\r\n                0,\r\n                this.IMAGE_WIDTH,\r\n                this.IMAGE_HEIGHT\r\n              );\r\n              this.ctx.globalAlpha = 1.0;\r\n            }\r\n          }\r\n        }\r\n      }\r\n      // 专注模式下，只显示选中图形\r\n      const renderList = this.focusMode\r\n        ? this.activeShape.type\r\n          ? [this.activeShape]\r\n          : []\r\n        : this.dataset;\r\n      for (let i = 0; i < renderList.length; i++) {\r\n        const shape = renderList[i];\r\n        if (shape.hiddening) continue;\r\n        switch (shape.type) {\r\n          case Shape.Rect:\r\n            this.drawRect(shape as Rect);\r\n            break;\r\n          case Shape.Polygon:\r\n            this.drawPolygon(shape as Polygon);\r\n            break;\r\n          case Shape.Dot:\r\n            this.drawDot(shape as Dot);\r\n            break;\r\n          case Shape.Line:\r\n            this.drawLine(shape as Line);\r\n            break;\r\n          case Shape.Circle:\r\n            this.drawCirle(shape as Circle);\r\n            break;\r\n          case Shape.Grid:\r\n            this.drawGrid(shape as Grid);\r\n            break;\r\n          case Shape.Brush:\r\n            this.drawBrush(shape as Brush);\r\n            break;\r\n          case Shape.Mask:\r\n            this.drawMask(shape as Mask);\r\n            break;\r\n          case Shape.Pencil:\r\n            this.drawPencil(shape as Pencil);\r\n            break;\r\n          default:\r\n            break;\r\n        }\r\n      }\r\n      if (\r\n        [\r\n          Shape.Rect,\r\n          Shape.Polygon,\r\n          Shape.Line,\r\n          Shape.Circle,\r\n          Shape.Grid\r\n        ].includes(this.activeShape.type) &&\r\n        !this.activeShape.hiddening\r\n      ) {\r\n        this.drawCtrlList(this.activeShape);\r\n      }\r\n      // 绘制智能标注点\r\n      if (this.magicPoints.length) {\r\n        for (const thisPrompt of this.magicPoints) {\r\n          this.drawPromptPointOnClick(thisPrompt, this.canvas);\r\n        }\r\n      }\r\n      this.ctx.restore();\r\n      this.emit(\"updated\", this.dataset);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * 隐藏选中的图形\r\n   */\r\n  hideActiveShape(uuid: string) {\r\n    if (uuid) {\r\n      this.hideList.push(uuid);\r\n      for (let i = 0; i < this.dataset.length; i++) {\r\n        if (this.dataset[i].uuid === uuid) {\r\n          this.dataset[i].hiddening = true;\r\n          this.dataset[i].dragging = false;\r\n          this.dataset[i].active = false;\r\n          break;\r\n        }\r\n      }\r\n      this.update();\r\n      // this.manageDoneList(deepClone(this.dataset));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 显示隐藏的图形\r\n   */\r\n  showHiddenShape() {\r\n    if (this.hideList.length) {\r\n      for (let i = 0; i < this.dataset.length; i++) {\r\n        if (this.dataset[i].uuid === this.hideList[this.hideList.length - 1]) {\r\n          this.dataset[i].hiddening = false;\r\n          this.dataset[i].active = true;\r\n        } else {\r\n          this.dataset[i].active = false;\r\n        }\r\n      }\r\n      this.hideList.pop();\r\n      this.update();\r\n      // this.manageDoneList(deepClone(this.dataset));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 删除指定矩形\r\n   * @param index number\r\n   */\r\n  deleteByIndex(index: number) {\r\n    const num = this.dataset.findIndex((x) => x.index === index);\r\n    if (num > -1) {\r\n      this.emit(\"delete\", this.dataset[num]);\r\n      this.dataset.splice(num, 1);\r\n      this.dataset.forEach((item, i) => {\r\n        item.index = i;\r\n      });\r\n      this.update();\r\n      this.manageDoneList(deepClone(this.dataset));\r\n      // this.manageDoneList(deepClone(this.dataset));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 修改选中图像的标注信息\r\n   * @param tagId string\r\n   * @param label string\r\n   * @param color string\r\n   */\r\n  updateLabelByIndex(\r\n    index: number,\r\n    tagId: string,\r\n    label: string,\r\n    color: string,\r\n    properties: string[]\r\n  ) {\r\n    const updateProperties = (item: any) => {\r\n      properties.forEach((prop) => {\r\n        if (prop === \"label\") {\r\n          item.label = label;\r\n        } else if (prop === \"tagId\") {\r\n          item.tagId = tagId;\r\n        } else if (prop === \"strokeStyle\") {\r\n          // if(item.type === 7 && this.isRGBA(color)){\r\n          //     item.strokeStyle = this.rgbaToHex(color);\r\n          // } else {\r\n          item.strokeStyle = color;\r\n          // }\r\n        } else if (prop === \"textFillStyle\") {\r\n          item.textFillStyle = color;\r\n        } else if (prop === \"fillStyle\") {\r\n          // if(item.type === 7 && this.isRGBA(color)){\r\n          //     item.fillStyle = this.rgbaToHex(color);\r\n          // } else {\r\n          item.fillStyle = color;\r\n          // }\r\n        }\r\n      });\r\n    };\r\n\r\n    if (index !== -1) {\r\n      updateProperties(this.dataset[index]);\r\n      if (this.dataset[index].type === Shape.Pencil) {\r\n        this.emit(\"updateLabel\", this.dataset[index]);\r\n      }\r\n    } else {\r\n      // 注意:不能使用if(this.activeShape)判断，会始终为true\r\n      if (Object.keys(this.activeShape).length !== 0) {\r\n        updateProperties(this.activeShape);\r\n        if (this.activeShape.type === Shape.Pencil) {\r\n          this.emit(\"updateLabel\", this.activeShape);\r\n        }\r\n      }\r\n    }\r\n\r\n    this.update();\r\n    this.manageDoneList(deepClone(this.dataset));\r\n  }\r\n\r\n  /**\r\n   * 删除画布中创建的所有图形\r\n   * @param index number\r\n   */\r\n  deleteAllShape() {\r\n    this.dataset = [];\r\n    this.update();\r\n    this.manageDoneList(deepClone(this.dataset));\r\n  }\r\n\r\n  /**\r\n   * 复制指定矩形  水平为x，竖直为y\r\n   * @param index number\r\n   */\r\n  copyByIndex(index: number) {\r\n    const num = this.dataset.findIndex((x) => x.index === index);\r\n    if (num > -1) {\r\n      if (this.activeShape.type === Shape.Rect) {\r\n        const newItem = deepClone(this.dataset[num]); // 深拷贝对象\r\n        const height = newItem.coor[1][1] - newItem.coor[0][1];\r\n        const width = newItem.coor[1][0] - newItem.coor[0][0];\r\n        const [x, y] = this.mouse || [];\r\n        // 鼠标位置未超出图片背景\r\n        if (this.isPointInBackground(this.mouse)) {\r\n          if (\r\n            this.isPointInBackground([\r\n              x + width * this.scale,\r\n              y + height * this.scale\r\n            ])\r\n          ) {\r\n            // 如果鼠标区域为左上角，右下角未超出\r\n            newItem.coor[0] = [\r\n              (x - this.originX) / this.scale,\r\n              (y - this.originY) / this.scale\r\n            ];\r\n            newItem.coor[1] = [\r\n              (x - this.originX) / this.scale + width,\r\n              (y - this.originY) / this.scale + height\r\n            ];\r\n          } else if (\r\n            this.isPointInBackground([\r\n              x - width * this.scale,\r\n              y - height * this.scale\r\n            ])\r\n          ) {\r\n            // 如果鼠标区域为右下角，左上角未超出\r\n            newItem.coor[0] = [\r\n              (x - this.originX) / this.scale - width,\r\n              (y - this.originY) / this.scale - height\r\n            ];\r\n            newItem.coor[1] = [\r\n              (x - this.originX) / this.scale,\r\n              (y - this.originY) / this.scale\r\n            ];\r\n          } else if (\r\n            this.isPointInBackground([\r\n              x + width * this.scale,\r\n              y - height * this.scale\r\n            ])\r\n          ) {\r\n            // 如果鼠标区域为左下角，右上角未超出\r\n            newItem.coor[0] = [\r\n              (x - this.originX) / this.scale,\r\n              (y - this.originY) / this.scale - height\r\n            ];\r\n            newItem.coor[1] = [\r\n              (x - this.originX) / this.scale + width,\r\n              (y - this.originY) / this.scale\r\n            ];\r\n          } else if (\r\n            this.isPointInBackground([\r\n              x - width * this.scale,\r\n              y + height * this.scale\r\n            ])\r\n          ) {\r\n            // 如果鼠标区域为右上角，左下角未超出\r\n            newItem.coor[0] = [\r\n              (x - this.originX) / this.scale - width,\r\n              (y - this.originY) / this.scale\r\n            ];\r\n            newItem.coor[1] = [\r\n              (x - this.originX) / this.scale,\r\n              (y - this.originY) / this.scale + height\r\n            ];\r\n          } else {\r\n            return;\r\n          }\r\n        } else {\r\n          return;\r\n        }\r\n        newItem.uuid = createUuid();\r\n        this.dataset.push(newItem); // 添加到 dataset 中\r\n        this.dataset[num].active = false;\r\n        this.dataset.forEach((item, i) => {\r\n          item.index = i;\r\n        });\r\n        this.update();\r\n        this.manageDoneList(deepClone(this.dataset));\r\n      } else if (this.activeShape.type === Shape.Dot) {\r\n        const newItem = deepClone(this.dataset[num]);\r\n        const [x, y] = this.mouse || [];\r\n        if (this.isPointInBackground(this.mouse)) {\r\n          newItem.coor[0] = (x - this.originX) / this.scale;\r\n          newItem.coor[1] = (y - this.originY) / this.scale;\r\n          // 防止位置重叠\r\n          if (\r\n            newItem.coor[0] == this.dataset[num].coor[0] &&\r\n            newItem.coor[1] == this.dataset[num].coor[1]\r\n          ) {\r\n            newItem.coor[0] += 2;\r\n            newItem.coor[1] += 2;\r\n          }\r\n        } else {\r\n          return;\r\n        }\r\n        newItem.uuid = createUuid();\r\n        this.dataset.push(newItem); // 添加到 dataset 中\r\n        this.dataset[num].active = false;\r\n        this.dataset.forEach((item, i) => {\r\n          item.index = i;\r\n        });\r\n        this.update();\r\n        this.manageDoneList(deepClone(this.dataset));\r\n      } else if (this.activeShape.type === Shape.Circle) {\r\n        const newItem = new Circle(\r\n          {\r\n            ...this.dataset[num], // 复制所有简单属性\r\n            coor: [...this.dataset[num].coor], // 深拷贝数组\r\n            radius: this.activeShape.radius // 深拷贝 radius\r\n          },\r\n          this.dataset[num].index\r\n        );\r\n        const [x, y] = this.mouse || [];\r\n        if (this.isPointInBackground(this.mouse)) {\r\n          newItem.coor[0] = (x - this.originX) / this.scale;\r\n          newItem.coor[1] = (y - this.originY) / this.scale;\r\n          let point1: Point = [x - newItem.radius, y]; //左顶点\r\n          let point2: Point = [x + newItem.radius, y]; //右顶点\r\n          let point3: Point = [x, y - newItem.radius]; //上顶点\r\n          let point4: Point = [x, y + newItem.radius]; //下顶点\r\n          if (!this.isPointInBackground(point1)) {\r\n            newItem.coor[0] = (x - this.originX) / this.scale + newItem.radius;\r\n            newItem.coor[1] = (y - this.originY) / this.scale;\r\n            if (!this.isPointInBackground(point2)) {\r\n              return;\r\n            }\r\n          }\r\n          if (!this.isPointInBackground(point2)) {\r\n            newItem.coor[0] = (x - this.originX) / this.scale - newItem.radius;\r\n            newItem.coor[1] = (y - this.originY) / this.scale;\r\n            if (!this.isPointInBackground(point1)) {\r\n              return;\r\n            }\r\n          }\r\n          if (!this.isPointInBackground(point3)) {\r\n            newItem.coor[0] = (x - this.originX) / this.scale;\r\n            newItem.coor[1] = (y - this.originY) / this.scale + newItem.radius;\r\n            if (!this.isPointInBackground(point4)) {\r\n              return;\r\n            }\r\n          }\r\n          if (!this.isPointInBackground(point4)) {\r\n            newItem.coor[0] = (x - this.originX) / this.scale;\r\n            newItem.coor[1] = (y - this.originY) / this.scale - newItem.radius;\r\n            if (!this.isPointInBackground(point3)) {\r\n              return;\r\n            }\r\n          }\r\n        } else {\r\n          return;\r\n        }\r\n        newItem.uuid = createUuid();\r\n        this.dataset.push(newItem); // 添加到 dataset 中\r\n        this.dataset[num].active = false;\r\n        this.dataset.forEach((item, i) => {\r\n          item.index = i;\r\n        });\r\n        this.update();\r\n        this.manageDoneList(deepClone(this.dataset));\r\n        return;\r\n      } else if (this.activeShape.type === Shape.Line) {\r\n        return;\r\n      } else if (this.activeShape.type === Shape.Polygon) {\r\n        return;\r\n      } else if (this.activeShape.type === Shape.Grid) {\r\n        return;\r\n      } else if (this.activeShape.type === Shape.None) {\r\n        return;\r\n      } else {\r\n        return;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 计算缩放步长\r\n   */\r\n  // calcStep(flag = \"\") {\r\n  //   console.log(\"calcStep\");\r\n  //   // 如果图片小于指定的宽高，且 flag 为空或 'b'，执行放大操作\r\n  //   if (this.IMAGE_WIDTH < this.WIDTH && this.IMAGE_HEIGHT < this.HEIGHT) {\r\n  //     if (flag === \"\" || flag === \"b\") {\r\n  //       this.setScale(true, false, true); // 执行放大\r\n  //       // 仅在没有递归过的情况下才继续递归\r\n  //       if (flag !== \"b\") {\r\n  //         this.calcStep(\"b\"); // 递归调用，避免重复递归\r\n  //       }\r\n  //     }\r\n  //   }\r\n\r\n  //   // 如果图片大于指定的宽高，且 flag 为空或 's'，执行缩小操作\r\n  //   if (this.IMAGE_WIDTH > this.WIDTH || this.IMAGE_HEIGHT > this.HEIGHT) {\r\n  //     if (flag === \"\" || flag === \"s\") {\r\n  //       this.setScale(false, false, true); // 执行缩小\r\n  //       // 仅在没有递归过的情况下才继续递归\r\n  //       if (flag !== \"s\") {\r\n  //         this.calcStep(\"s\"); // 递归调用，避免重复递归\r\n  //       }\r\n  //     }\r\n  //   }\r\n  //   return;\r\n  // }\r\n  calcStep(flag = \"\") {\r\n    if (this.IMAGE_WIDTH < this.WIDTH && this.IMAGE_HEIGHT < this.HEIGHT) {\r\n      if (flag === \"\" || flag === \"b\") {\r\n        this.setScale(true, false, true);\r\n        this.calcStep(\"b\");\r\n      }\r\n    }\r\n    if (this.IMAGE_WIDTH > this.WIDTH || this.IMAGE_HEIGHT > this.HEIGHT) {\r\n      if (flag === \"\" || flag === \"s\") {\r\n        this.setScale(false, false, true);\r\n        this.calcStep(\"s\");\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 缩放\r\n   * @param type true放大5%，false缩小5%\r\n   * @param center 缩放中心 center|mouse\r\n   * @param pure 不绘制\r\n   */\r\n  setScale(type: boolean, byMouse = false, pure = false) {\r\n    if (this.lock) return;\r\n    if (\r\n      (!type && this.imageMin < this.MIN_LENGTH) ||\r\n      (type && this.IMAGE_WIDTH > this.imageOriginMax * 10)\r\n    )\r\n      return;\r\n    if (type) {\r\n      this.scaleStep++;\r\n    } else {\r\n      this.scaleStep--;\r\n    }\r\n    let realToLeft = 0;\r\n    let realToRight = 0;\r\n    const [x, y] = this.mouse || [];\r\n    if (byMouse) {\r\n      realToLeft = (x - this.originX) / this.scale;\r\n      realToRight = (y - this.originY) / this.scale;\r\n    }\r\n    const abs = Math.abs(this.scaleStep);\r\n    const width = this.IMAGE_WIDTH;\r\n    this.IMAGE_WIDTH = Math.round(\r\n      this.IMAGE_ORIGIN_WIDTH * (this.scaleStep >= 0 ? 1.1 : 0.9) ** abs\r\n    );\r\n    this.IMAGE_HEIGHT = Math.round(\r\n      this.IMAGE_ORIGIN_HEIGHT * (this.scaleStep >= 0 ? 1.1 : 0.9) ** abs\r\n    );\r\n    if (byMouse) {\r\n      this.originX = x - realToLeft * this.scale;\r\n      this.originY = y - realToRight * this.scale;\r\n    } else {\r\n      const scale = this.IMAGE_WIDTH / width;\r\n      this.originX = this.WIDTH / 2 - (this.WIDTH / 2 - this.originX) * scale;\r\n      this.originY = this.HEIGHT / 2 - (this.HEIGHT / 2 - this.originY) * scale;\r\n    }\r\n    this.emit(\"scale\", { type: type, byMouse: byMouse, pure: pure });\r\n    if (!pure) {\r\n      this.update();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 适配背景图\r\n   */\r\n  fitZoom() {\r\n    this.calcStep();\r\n    if (this.IMAGE_HEIGHT / this.IMAGE_WIDTH >= this.HEIGHT / this.WIDTH) {\r\n      this.IMAGE_WIDTH =\r\n        this.IMAGE_ORIGIN_WIDTH / (this.IMAGE_ORIGIN_HEIGHT / this.HEIGHT);\r\n      this.IMAGE_HEIGHT = this.HEIGHT;\r\n    } else {\r\n      this.IMAGE_WIDTH = this.WIDTH;\r\n      this.IMAGE_HEIGHT =\r\n        this.IMAGE_ORIGIN_HEIGHT / (this.IMAGE_ORIGIN_WIDTH / this.WIDTH);\r\n    }\r\n    this.originX = (this.WIDTH - this.IMAGE_WIDTH) / 2;\r\n    this.originY = (this.HEIGHT - this.IMAGE_HEIGHT) / 2;\r\n    this.textscaleStep = 0;\r\n    this.emit(\"fitZoom\");\r\n    this.update();\r\n  }\r\n\r\n  /**\r\n   * 恢复为原始图片尺寸\r\n   */\r\n  initZoom() {\r\n    // this.calcStep();\r\n    this.IMAGE_WIDTH = this.IMAGE_ORIGIN_WIDTH;\r\n    this.IMAGE_HEIGHT = this.IMAGE_ORIGIN_HEIGHT;\r\n    this.originX = (this.WIDTH - this.IMAGE_WIDTH) / 2;\r\n    this.originY = (this.HEIGHT - this.IMAGE_HEIGHT) / 2;\r\n    this.textscaleStep = 0;\r\n    // this.update();\r\n  }\r\n\r\n  /**\r\n   * 设置专注模式\r\n   * @param type {boolean}\r\n   */\r\n  setFocusMode(type: boolean) {\r\n    this.focusMode = type;\r\n    this.update();\r\n    // this.manageDoneList(deepClone(this.dataset));\r\n  }\r\n\r\n  manageDoneList(dataset: AllShape[]) {\r\n    this.doneList.push(dataset);\r\n    if (this.doneList.length > this.MAX_LENGTH) {\r\n      this.doneList.shift();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 撤销操作（目前不支持撤销隐藏、显示、专注等模式和状态切换）\r\n   * 若支持，需要设置一个操作数组，每次往doneList中push时，记录下操作类型。撤销时，执行相应的逆方法\r\n   */\r\n  undo() {\r\n    if (this.doneList.length > 1) {\r\n      this.clickIndex = -1; // 重置点击索引\r\n      const lastDoneItem = this.doneList[this.doneList.length - 1];\r\n      this.undoList.push(lastDoneItem);\r\n      this.doneList.pop();\r\n      const newShapes = deepClone(this.doneList[this.doneList.length - 1]);\r\n      this.setData(newShapes, false);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 重做操作\r\n   */\r\n  redo() {\r\n    if (this.undoList.length > 0) {\r\n      this.clickIndex = -1; // 重置点击索引\r\n      const lastDoneItem = this.undoList[this.undoList.length - 1];\r\n      this.manageDoneList(lastDoneItem);\r\n      this.undoList.pop();\r\n      const newShapes = deepClone(this.doneList[this.doneList.length - 1]);\r\n      this.setData(newShapes, false);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 销毁\r\n   */\r\n  destroy() {\r\n    if (!this.canvas) return;\r\n    this.image.removeEventListener(\"load\", this.handleLoad);\r\n    this.canvas.removeEventListener(\"contextmenu\", this.handleContextmenu);\r\n    this.canvas.removeEventListener(\"mousewheel\", this.handleMousewheel);\r\n    this.canvas.removeEventListener(\"wheel\", this.handleMousewheel);\r\n    this.canvas.removeEventListener(\"mousedown\", this.handleMouseDown);\r\n    this.canvas.removeEventListener(\"touchstart\", this.handleMouseDown);\r\n    this.canvas.removeEventListener(\"mousemove\", this.handleMouseMove);\r\n    this.canvas.removeEventListener(\"touchmove\", this.handleMouseMove);\r\n    this.canvas.removeEventListener(\"mouseup\", this.handleMouseUp);\r\n    this.canvas.removeEventListener(\"touchend\", this.handleMouseUp);\r\n    this.canvas.removeEventListener(\"dblclick\", this.handleDblclick);\r\n    document.body.removeEventListener(\"keydown\", this.handleKeydown, true);\r\n    document.body.removeEventListener(\"keyup\", this.handleKeyup, true);\r\n    this.canvas.width = this.WIDTH;\r\n    this.canvas.height = this.HEIGHT;\r\n    this.canvas.style.width = null;\r\n    this.canvas.style.height = null;\r\n    this.canvas.style.userSelect = null;\r\n  }\r\n\r\n  /**\r\n   * 重新设置画布大小\r\n   */\r\n  resize(\r\n    width: number,\r\n    height: number,\r\n    alpha: number = 1,\r\n    imageurl: string = \"\"\r\n  ) {\r\n    this.canvas.width = width;\r\n    this.canvas.height = height;\r\n    this.canvas.style.width = String(width) + \"px\";\r\n    this.canvas.style.height = String(height) + \"px\";\r\n    if (imageurl !== \"\" || this.imagesrc === undefined) {\r\n      this.imagesrc = imageurl;\r\n    }\r\n    this.setImage(this.imagesrc, alpha);\r\n    this.initSetting();\r\n    this.update();\r\n  }\r\n}\r\n","import Shape from './Shape';\r\n\r\nexport default class Rect extends Shape {\r\n  public type = 1\r\n  public iscontour = false\r\n  constructor(item: any, index: number) {\r\n    super(item, index)\r\n    // this.iscontour = item.iscontour || this.iscontour // 智能标注框\r\n  }\r\n  get ctrlsData() {\r\n    const [[x0, y0], [x1, y1]] = this.coor;\r\n    return [\r\n      [x0, y0],\r\n      [x0 + (x1 - x0) / 2, y0],\r\n      [x1, y0],\r\n      [x1, y0 + (y1 - y0) / 2],\r\n      [x1, y1],\r\n      [x0 + (x1 - x0) / 2, y1],\r\n      [x0, y1],\r\n      [x0, y0 + (y1 - y0) / 2],\r\n    ];\r\n  }\r\n}\r\n","import Shape from './Shape';\r\n\r\nexport default class Polygon extends Shape {\r\n  public type = 2\r\n  constructor(item: any, index: number) {\r\n    super(item, index)\r\n  }\r\n  get ctrlsData() {\r\n    return this.coor.length > 2 ? this.coor : [];\r\n  }\r\n}\r\n","import Shape from './Shape';\r\n\r\nexport default class Dot extends Shape {\r\n    public type = 3\r\n    public color = '' // 智能标注（SAM）时，green左键加点，red右键加点，''表示关键点（非智能标注点）\r\n    constructor(item: any, index: number) {\r\n        super(item, index)\r\n        this.color = item.color || this.color\r\n    }\r\n}\r\n","export default class EventBus {\r\n    private _eventTree: Record<string, any> = {}\r\n    /**\r\n   * 注册事件\r\n   * @param eventName 事件名称\r\n   * @param cb 回调方法\r\n   */\r\n    on(eventName: string, cb: Function) {\r\n        const fns = this._eventTree[eventName];\r\n        if (Array.isArray(fns)) {\r\n            fns.push(cb);\r\n        } else {\r\n            this._eventTree[eventName] = [cb];\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 触发事件\r\n     * @param eventName 事件名称\r\n     * @param payload 传递参数\r\n     */\r\n    emit(eventName: string, ...payload: any) {\r\n        const fns = this._eventTree[eventName];\r\n        if (Array.isArray(fns)) {\r\n            fns.forEach((fn) => fn(...payload));\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 注销事件\r\n     * @param eventName 事件名称\r\n     * @param cb 传递参数\r\n     */\r\n    off(eventName: string, cb: Function) {\r\n        const fns = this._eventTree[eventName];\r\n        const index = fns.find((fn: Function) => fn === cb);\r\n        if (Array.isArray(fns) && index) {\r\n            fns.splice(index, 1);\r\n        }\r\n    }\r\n}\r\n","import Shape from \"./Shape\";\r\n\r\nexport default class Line extends Shape {\r\n  public type = 4;\r\n\r\n  constructor(item: any, index: number) {\r\n    super(item, index);\r\n  }\r\n  get ctrlsData() {\r\n    return this.coor.length > 1 ? this.coor : [];\r\n  }\r\n}\r\n","import Shape from './Shape';\r\n\r\nexport default class Circle extends Shape {\r\n    public type = 5\r\n    public radius = 0\r\n    constructor(item: any, index: number) {\r\n        super(item, index)\r\n        this.radius = item.radius || this.radius\r\n    }\r\n    get ctrlsData() {\r\n        const [x, y] = this.coor\r\n        return [\r\n            [x, y - this.radius],\r\n            [x + this.radius, y],\r\n            [x, y + this.radius],\r\n            [x - this.radius, y]\r\n        ]\r\n    }\r\n}\r\n","import Shape from './Shape';\r\nimport Rect from './Rect'\r\n\r\nexport default class Grid extends Shape {\r\n  public type = 6\r\n  public row = 1\r\n  public col = 1\r\n  public selected: number[] = []\r\n  public selectedFillStyle: string\r\n\r\n  constructor(item: any, index: number) {\r\n    super(item, index)\r\n    this.row = item.row > 0 ? item.row : this.row\r\n    this.col = item.col > 0 ? item.col : this.col\r\n    this.selected = Array.isArray(item.selected) ? item.selected : []\r\n  }\r\n\r\n  get ctrlsData() {\r\n    const [[x0, y0], [x1, y1]] = this.coor;\r\n    return [\r\n      [x0, y0],\r\n      [x0 + (x1 - x0) / 2, y0],\r\n      [x1, y0],\r\n      [x1, y0 + (y1 - y0) / 2],\r\n      [x1, y1],\r\n      [x0 + (x1 - x0) / 2, y1],\r\n      [x0, y1],\r\n      [x0, y0 + (y1 - y0) / 2],\r\n    ];\r\n  }\r\n\r\n  get gridRects() {\r\n    const [[x0, y0], [x1, y1]] = this.coor;\r\n    const { row, col, strokeStyle, fillStyle, active, creating, lineWidth } = this;\r\n    const w = (x1 - x0) / this.col;\r\n    const h = (y1 - y0) / this.row;\r\n    const list: Rect[] = []\r\n    for (let i = 0; i < row; i++) {\r\n      for (let j = 0; j < col; j++) {\r\n        const startPoint = [x0 + j * w, y0 + i * h];\r\n        const index = i * col + j;\r\n        const shape = new Rect({\r\n          coor: [startPoint, [startPoint[0] + w, startPoint[1] + h]],\r\n          strokeStyle, fillStyle, active, creating, lineWidth\r\n        }, index);\r\n        list.push(shape)\r\n      }\r\n    }\r\n    return list;\r\n  }\r\n}\r\n","import Shape from \"./Shape\";\r\n\r\nexport default class Brush extends Shape {\r\n  public type = 7;\r\n  public brushWidth: number = 1;\r\n  public iseraser = false;\r\n  public boundingRect: number[] = [];\r\n  constructor(item: any, index: number) {\r\n    super(item, index);\r\n    this.iseraser = item.iseraser || this.iseraser;\r\n    this.boundingRect = item.boundingRect || this.boundingRect;\r\n  }\r\n\r\n  get ctrlsData() {\r\n    return this.coor.length > 3 ? this.coor : [];\r\n  }\r\n}\r\n","import Shape from './Shape';\r\ninterface MagicPoint {\r\n  coor: [number, number];\r\n  color: string;\r\n}\r\n\r\nexport default class Mask extends Shape {\r\n  public type = 8\r\n  public maskType = '' //everything || click || reat\r\n  public maskBase64 = ''\r\n  public pixels :number[] = []\r\n  public canvasData :ImageData = null \r\n  // public rectcoor = ''\r\n  public height = 0\r\n  public weight = 0\r\n  public maskToPolygon = false\r\n  public magicPoints : MagicPoint[] = []\r\n  constructor(item: any, index: number) {\r\n    super(item, index)\r\n    this.maskType = item.maskType || ''\r\n    this.maskBase64 = item.maskBase64 || ''\r\n    this.pixels = item.pixels || []\r\n    this.canvasData = item.canvasData || null\r\n    this.height = item.height || 0\r\n    this.weight = item.weight || 0\r\n    // this.rectcoor = item.rectcoor || this.rectcoor\r\n    this.maskToPolygon = item.maskToPolygon || false\r\n    this.magicPoints = item.magicPoints || []\r\n  }\r\n\r\n}\r\n","import Shape from \"./Shape\";\r\n\r\nexport default class Line extends Shape {\r\n  public type = 9;\r\n  public boundingRect: number[] = [];\r\n  constructor(item: any, index: number) {\r\n    super(item, index);\r\n    this.boundingRect = item.boundingRect || this.boundingRect;\r\n  }\r\n  get ctrlsData() {\r\n    return this.coor.length > 3 ? this.coor : [];\r\n  }\r\n}\r\n"],"names":["createUuid","s","hexDigits","i","m","Math","floor","random","slice","n","join","isPointInPolygon","x","y","vertices","inside","length","j","xi","yi","xj","yj","deepClone","obj","hash","WeakMap","has","get","ImageData","newImageData","Uint8ClampedArray","data","width","height","set","Date","getTime","RegExp","source","flags","Map","result_1","forEach","value","key","Set","result_2","add","Array","isArray","result_3","item","index","result","Object","create","getPrototypeOf","Reflect","ownKeys","deepEqual","obj1","obj2","keysToCompare","type","maskKeysToCompare_1","__values","maskKeysToCompare_1_1","done","next","keys1","keys","keys1_1","keys1_1_1","Shape","this","tagId","label","labelId","truncated","coor","active","creating","dragging","hiddening","locking","uuid","assign","Rect","_super","_this","call","iscontour","__extends","defineProperty","prototype","_a","__read","_b","x0","y0","_c","x1","y1","Polygon","Dot","color","EventBus","_eventTree","on","eventName","cb","fns","push","emit","payload","_i","arguments","fn","apply","__spreadArray","off","find","splice","Line","Circle","radius","Grid","row","col","selected","_d","strokeStyle","fillStyle","lineWidth","w","h","list","startPoint","shape","Brush","brushWidth","iseraser","boundingRect","Mask","maskType","maskBase64","pixels","canvasData","weight","maskToPolygon","magicPoints","CanvasSelect","el","src","version","pkg","lock","readonly","MIN_WIDTH","MIN_HEIGHT","MIN_RADIUS","MIN_POINTNUM","MIN_LENGTH","activeStrokeStyle","activeFillStyle","ctrlStrokeStyle","ctrlFillStyle","ctrlRadius","hideLabel","labelFillStyle","labelFontFamily","labelFontSize","textFillStyle","labelMaxLen","WIDTH","HEIGHT","imagesrc","imagealpha","olddataset","dataset","MAX_LENGTH","doneList","undoList","hideList","remmberOrigin","createType","None","ctrlIndex","clickIndex","image","Image","IMAGE_WIDTH","IMAGE_ORIGIN_HEIGHT","IMAGE_HEIGHT","originX","originY","scaleStep","textscaleStep","scrollZoom","dblTouch","dblTouchStore","alpha","focusMode","scaleTouchStore","isTouch2","isMobile","navigator","userAgent","includes","labelUp","isCtrlKey","ctrlCode","gridMenuEnable","gridSelectedFillStyle","ispainting","brushlineWidth","brushstrokeStyle","pencillineWidth","pencilstrokeStyle","mask_alpha","densityFactor","activeCanvasData","activePolygon","isEraser","isErasing","eraserPoints","eraserSize","random_color","r","g","b","isMagicToolActive","maxLinePointCount","getImagedataFromImageClass","masktype","maskCanvas","document","createElement","maskContext","getContext","willReadFrequently","console","error","tmpCanvas","tmpContext","drawImage","imageData","getImageData","pixelData","imageMask","maskData","colorIndex","putImageData","scaledCanvas","scaledContext","drawPromptPointOnClick","thisPrompt","canvas","scale","strokeColor","context","beginPath","arc","PI","fill","stroke","handleLoad","bind","handleContextmenu","handleMousewheel","handleMouseDown","handleMouseMove","handleMouseUp","handleDblclick","handleKeyup","handleKeydown","container","querySelector","HTMLCanvasElement","offScreen","initSetting","initEvents","setImage","red","green","blue","warn","IMAGE_ORIGIN_WIDTH","min","max","mergeEvent","e","mouseX","mouseY","mouseCX","mouseCY","touches","clientX","clientY","target","getBoundingClientRect","left","top_1","top","round","clientX1","_e","clientY1","abs","offsetX","offsetY","__assign","fitZoom","preventDefault","evt","stopPropagation","mouse","deltaY","imageMin","imageOriginMax","setScale","buttons","ctrls","activeShape","ctrlsData","findIndex","isPointInCircle","log","update","remmber","isInBackground","nx","ny","hitOnShape","hitShapeIndex_1","hitShape","Pencil","pt","sort","a","newShape","curPoint","sp","rowCol","prompt","_f","split","test","Number","_g","_h","a0","b0","_j","a1","b1","concat","newPoint","newRadius","noLimit","_k","t1","tar","_l","sqrt","pow","which","touch0","touch1","cur","now","pop","removeDuplicatePoints","resultCoor","resultRect","manageDoneList","canPolygon","canLine","gridRects","rect","isPointInRect","thisIndex","code","activeElement","body","deleteByIndex","copyByIndex","dpr","window","devicePixelRatio","style","userSelect","ctx","clientWidth","clientHeight","offScreenCtx","addEventListener","removeEventListener","getscaledPoint","url","crossOrigin","handleMaskShape","tempshape","maskImage","Promise","resolve","reject","onload","putDataOnCanvas","polygonShape","getContourPointsOfColoredRegion","onerror","err","setData","needCreate","toMask","initSize","setTimeout","__awaiter","initdata","itemIndexMap_1","data_1","data_1_1","toString","undefined","mousePoint","hitShapeIndex","isPointInBackground","isPointInLine","isMouseInPixelsRegion","hitOnShapeVertex","point","pointX","pointY","map","isPointOnRectEdge","onLeftEdge","onRightEdge","onTopEdge","onBottomEdge","isPointOnRectVertex","onLeftTopPoint","onRightBottomEdge","onRightTopEdge","onLeftBottomEdge","save","clearRect","translate","moveTo","lineTo","closePath","areaData","restore","isPointOnPolygonVertex","some","center","isPointOnCircleVertex","getBoundingBoxOfColoredRegion","xMin","xMax","yMin","yMax","contourPoints","isBorderPoint","uniquePoints","sampledPoints","samplePointsByDensity","sortByPolarAngle","directions_1","directions_1_1","dx","dy","points","step","calculateCentroid","sumX","sumY","points_1","points_1_1","count","calculatePolarAngle","atan2","isNested","shape1","shape2","x2","y2","x3","y3","x4","y4","vertices1","vertices2","_m","drawRect","sub","fillRect","strokeRect","drawLabel","drawPolygon","lineJoin","calculateCenter","drawDot","drawCirle","drawLine","hexToRGBA","hex","hexCode","replace","char","parseInt","rgbaToHex","rgba","includeAlpha","rgbaArray","trim","match","parseFloat","hexR","padStart","hexG","hexB","hexA","isRGBA","getBunding","removePoints","seen","maxX","minX","maxY","minY","drawBrush","lineCap","globalCompositeOperation","drawGrid","selectedFillStyle","isSelected","drawCtrl","drawCtrlList","Error","sum","reduce","acc","thisCanvas","thisContext","replacementColor","highlightMask","activeColor","changeMaskPolygon","endMagicTool","drawMask","self","addPoint","deletePoint","drawPencil","hasEndPoint","validCoor","filter","clip","textPadding","newText","scaleFactor","font","textMetrics","measureText","labelWidth","labelHeight","currLineWidth","isLabelUp","toLeft","toTop","toTop2","isUp","rectX","rectY","rectWidth","rectHeight","textBaseline","textX","textY","fillText","cancelAnimationFrame","timer","initZoom","requestAnimationFrame","globalAlpha","renderList","hideActiveShape","showHiddenShape","num","updateLabelByIndex","properties","updateProperties","prop","deleteAllShape","newItem","point1","point2","point3","point4","calcStep","flag","byMouse","pure","realToLeft","realToRight","setFocusMode","shift","undo","lastDoneItem","newShapes","redo","destroy","resize","imageurl","String"],"mappings":"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"}